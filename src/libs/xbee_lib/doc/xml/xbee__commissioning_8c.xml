<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.13">
  <compounddef id="xbee__commissioning_8c" kind="file" language="C++">
    <compoundname>xbee_commissioning.c</compoundname>
    <includes local="no">stdio.h</includes>
    <includes refid="platform_8h" local="yes">xbee/platform.h</includes>
    <includes refid="zcl__commissioning_8h" local="yes">zigbee/zcl_commissioning.h</includes>
    <includes refid="atcmd_8h" local="yes">xbee/atcmd.h</includes>
    <includes refid="commissioning_8h" local="yes">xbee/commissioning.h</includes>
    <incdepgraph>
      <node id="1339">
        <label>xbee/device.h</label>
        <link refid="device_8h"/>
        <childnode refid="1325" relation="include">
        </childnode>
        <childnode refid="1340" relation="include">
        </childnode>
        <childnode refid="1331" relation="include">
        </childnode>
        <childnode refid="1333" relation="include">
        </childnode>
      </node>
      <node id="1323">
        <label>src/xbee/xbee_commissioning.c</label>
        <link refid="xbee__commissioning_8c"/>
        <childnode refid="1324" relation="include">
        </childnode>
        <childnode refid="1325" relation="include">
        </childnode>
        <childnode refid="1330" relation="include">
        </childnode>
        <childnode refid="1338" relation="include">
        </childnode>
        <childnode refid="1341" relation="include">
        </childnode>
      </node>
      <node id="1326">
        <label>errno.h</label>
      </node>
      <node id="1328">
        <label>xbee/jslong_glue.h</label>
        <link refid="jslong__glue_8h_source"/>
        <childnode refid="1329" relation="include">
        </childnode>
      </node>
      <node id="1327">
        <label>stddef.h</label>
      </node>
      <node id="1333">
        <label>wpan/aps.h</label>
        <link refid="aps_8h"/>
        <childnode refid="1331" relation="include">
        </childnode>
      </node>
      <node id="1335">
        <label>xbee/byteorder.h</label>
        <link refid="byteorder_8h"/>
        <childnode refid="1336" relation="include">
        </childnode>
        <childnode refid="1325" relation="include">
        </childnode>
      </node>
      <node id="1332">
        <label>zigbee/zcl.h</label>
        <link refid="zcl_8h"/>
        <childnode refid="1325" relation="include">
        </childnode>
        <childnode refid="1333" relation="include">
        </childnode>
        <childnode refid="1334" relation="include">
        </childnode>
      </node>
      <node id="1330">
        <label>zigbee/zcl_commissioning.h</label>
        <link refid="zcl__commissioning_8h"/>
        <childnode refid="1325" relation="include">
        </childnode>
        <childnode refid="1331" relation="include">
        </childnode>
        <childnode refid="1332" relation="include">
        </childnode>
        <childnode refid="1334" relation="include">
        </childnode>
      </node>
      <node id="1336">
        <label>string.h</label>
      </node>
      <node id="1331">
        <label>wpan/types.h</label>
        <link refid="types_8h"/>
        <childnode refid="1325" relation="include">
        </childnode>
      </node>
      <node id="1325">
        <label>xbee/platform.h</label>
        <link refid="platform_8h"/>
        <childnode refid="1326" relation="include">
        </childnode>
        <childnode refid="1327" relation="include">
        </childnode>
        <childnode refid="1328" relation="include">
        </childnode>
      </node>
      <node id="1338">
        <label>xbee/atcmd.h</label>
        <link refid="atcmd_8h"/>
        <childnode refid="1339" relation="include">
        </childnode>
      </node>
      <node id="1340">
        <label>xbee/serial.h</label>
        <link refid="serial_8h"/>
        <childnode refid="1325" relation="include">
        </childnode>
      </node>
      <node id="1334">
        <label>zigbee/zcl_types.h</label>
        <link refid="zcl__types_8h"/>
        <childnode refid="1325" relation="include">
        </childnode>
        <childnode refid="1335" relation="include">
        </childnode>
        <childnode refid="1337" relation="include">
        </childnode>
      </node>
      <node id="1337">
        <label>zigbee/zcl64.h</label>
        <link refid="zcl64_8h"/>
        <childnode refid="1325" relation="include">
        </childnode>
      </node>
      <node id="1341">
        <label>xbee/commissioning.h</label>
        <link refid="commissioning_8h"/>
        <childnode refid="1339" relation="include">
        </childnode>
        <childnode refid="1330" relation="include">
        </childnode>
      </node>
      <node id="1329">
        <label>xbee/jslong.h</label>
        <link refid="jslong_8h_source"/>
      </node>
      <node id="1324">
        <label>stdio.h</label>
      </node>
    </incdepgraph>
    <innerclass refid="structxbee__comm__reg__t" prot="public">xbee_comm_reg_t</innerclass>
    <innerclass refid="structxbee__comm__dl__t" prot="public">xbee_comm_dl_t</innerclass>
      <sectiondef kind="define">
      <memberdef kind="define" id="xbee__commissioning_8c_1ac9fe9907ad4d47dd27a9185365422af2" prot="public" static="no">
        <name>_set_param_bytes</name>
        <param><defname>req</defname></param>
        <param><defname>data</defname></param>
        <param><defname>len</defname></param>
        <initializer>(	<ref refid="group__util__byteorder_1gaf0f22982f04251ea70fba1fb30d55ef5" kindref="member">memcpy_htobe</ref>( buffer, <ref refid="group__xbee__io_1gac5955aa1e44ff234e6d78a19cf68f25c" kindref="member">data</ref>, len),	\
				<ref refid="group__xbee__atcmd_1ga6bd558a2d03eafe29b176f598d76ffd6" kindref="member">xbee_cmd_set_param_bytes</ref>( req, buffer, len) )</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/xbee/xbee_commissioning.c" line="274" column="11"/>
      </memberdef>
      <memberdef kind="define" id="xbee__commissioning_8c_1a33f5de5d27098876f1f90ffc3495c682" prot="public" static="no">
        <name>_hex_dump</name>
        <param><defname>data</defname></param>
        <param><defname>len</defname></param>
        <initializer><ref refid="group__hal_1gaa321236a0cb6f4e0dad592fdf1b550d2" kindref="member">hex_dump</ref>( buffer, len, <ref refid="group__hal_1gae60f842ae8bc3cc952cdeece611670d5" kindref="member">HEX_DUMP_FLAG_NONE</ref>)</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/xbee/xbee_commissioning.c" line="277" column="11"/>
      </memberdef>
      </sectiondef>
      <sectiondef kind="typedef">
      <memberdef kind="typedef" id="group__xbee__commissioning_1gaa98ef492d346b9dc608d7866597ec9a8" prot="public" static="no">
        <type>void(*</type>
        <definition>typedef void(* xbee_comm_fn) (zcl_comm_startup_param_t FAR *p, const void FAR *value_be)</definition>
        <argsstring>)(zcl_comm_startup_param_t FAR *p, const void FAR *value_be)</argsstring>
        <name>xbee_comm_fn</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/xbee/xbee_commissioning.c" line="32" column="1" bodyfile="src/xbee/xbee_commissioning.c" bodystart="32" bodyend="-1"/>
      </memberdef>
      </sectiondef>
      <sectiondef kind="var">
      <memberdef kind="variable" id="group__xbee__commissioning_1ga010b1bb0118167125a07e4bde6db5e36" prot="public" static="no" mutable="no">
        <type>const <ref refid="structxbee__comm__reg__t" kindref="compound">xbee_comm_reg_t</ref></type>
        <definition>const xbee_comm_reg_t xbee_comm_regs[]</definition>
        <argsstring>[]</argsstring>
        <name>xbee_comm_regs</name>
        <initializer>= {
	{ { { &apos;D&apos;, &apos;L&apos; } }, xbee_comm_DL },
	{ { { &apos;S&apos;, &apos;C&apos; } }, <ref refid="group__xbee__commissioning_1ga886012f757de4a74d0c992d3ab04a373" kindref="member">xbee_comm_SC</ref> },
	{ { { &apos;A&apos;, &apos;R&apos; } }, xbee_comm_AR },
	{ { { &apos;B&apos;, &apos;H&apos; } }, xbee_comm_BH },
	{ { { &apos;E&apos;, &apos;O&apos; } }, xbee_comm_EO },
	
	{ { { &apos;O&apos;, &apos;P&apos; } }, xbee_comm_OP },
	{ { { &apos;O&apos;, &apos;I&apos; } }, xbee_comm_OI },
}</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/xbee/xbee_commissioning.c" line="128" column="1" bodyfile="src/xbee/xbee_commissioning.c" bodystart="128" bodyend="-1"/>
      </memberdef>
      </sectiondef>
      <sectiondef kind="func">
      <memberdef kind="function" id="group__xbee__commissioning_1ga886012f757de4a74d0c992d3ab04a373" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void xbee_comm_SC</definition>
        <argsstring>(zcl_comm_startup_param_t FAR *p, const void FAR *value_be)</argsstring>
        <name>xbee_comm_SC</name>
        <param>
          <type><ref refid="structzcl__comm__startup__param__t" kindref="compound">zcl_comm_startup_param_t</ref> <ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref> *</type>
          <declname>p</declname>
        </param>
        <param>
          <type>const void <ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref> *</type>
          <declname>value_be</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><xrefsect id="todo_1_todo000010"><xreftitle>Todo</xreftitle><xrefdescription><para>Depending on the value of StartupControl, the extended_panid attribute might be set from ID (extended PAN ID) or OP (operating PAN ID).</para></xrefdescription></xrefsect></para><para>I think.</para><para>Note that spec (3.15.2.2.1.2) says that all Fs is used for &quot;unspecified&quot;, so we may need to map all 0s to all Fs. </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/xbee/xbee_commissioning.c" line="52" column="1" bodyfile="src/xbee/xbee_commissioning.c" bodystart="52" bodyend="56"/>
        <references refid="group__util__byteorder_1gabb9b3120f6457dc04471c134fee1d221" compoundref="byteorder_8h" startline="131">be16toh</references>
      </memberdef>
      <memberdef kind="function" id="group__xbee__commissioning_1ga38cdf15db91d2b0d3afc7288c4f4205a" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void xbee_comm_OP</definition>
        <argsstring>(zcl_comm_startup_param_t FAR *p, const void FAR *value_be)</argsstring>
        <name>xbee_comm_OP</name>
        <param>
          <type><ref refid="structzcl__comm__startup__param__t" kindref="compound">zcl_comm_startup_param_t</ref> <ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref> *</type>
          <declname>p</declname>
        </param>
        <param>
          <type>const void <ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref> *</type>
          <declname>value_be</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/xbee/xbee_commissioning.c" line="58" column="1" bodyfile="src/xbee/xbee_commissioning.c" bodystart="58" bodyend="69"/>
      </memberdef>
      <memberdef kind="function" id="group__xbee__commissioning_1ga9b5ced283d3e0d514a28b676935a3b95" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void xbee_comm_OI</definition>
        <argsstring>(zcl_comm_startup_param_t FAR *p, const void FAR *value_be)</argsstring>
        <name>xbee_comm_OI</name>
        <param>
          <type><ref refid="structzcl__comm__startup__param__t" kindref="compound">zcl_comm_startup_param_t</ref> <ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref> *</type>
          <declname>p</declname>
        </param>
        <param>
          <type>const void <ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref> *</type>
          <declname>value_be</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/xbee/xbee_commissioning.c" line="71" column="1" bodyfile="src/xbee/xbee_commissioning.c" bodystart="71" bodyend="74"/>
      </memberdef>
      <memberdef kind="function" id="group__xbee__commissioning_1gaa49a8990f5c4b47e2000f49b2258fc2c" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void xbee_comm_AR</definition>
        <argsstring>(zcl_comm_startup_param_t FAR *p, const void FAR *value_be)</argsstring>
        <name>xbee_comm_AR</name>
        <param>
          <type><ref refid="structzcl__comm__startup__param__t" kindref="compound">zcl_comm_startup_param_t</ref> <ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref> *</type>
          <declname>p</declname>
        </param>
        <param>
          <type>const void <ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref> *</type>
          <declname>value_be</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/xbee/xbee_commissioning.c" line="79" column="1" bodyfile="src/xbee/xbee_commissioning.c" bodystart="79" bodyend="95"/>
      </memberdef>
      <memberdef kind="function" id="group__xbee__commissioning_1gae214f43be9de8be54815b9351935202f" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void xbee_comm_BH</definition>
        <argsstring>(zcl_comm_startup_param_t FAR *p, const void FAR *value_be)</argsstring>
        <name>xbee_comm_BH</name>
        <param>
          <type><ref refid="structzcl__comm__startup__param__t" kindref="compound">zcl_comm_startup_param_t</ref> <ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref> *</type>
          <declname>p</declname>
        </param>
        <param>
          <type>const void <ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref> *</type>
          <declname>value_be</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/xbee/xbee_commissioning.c" line="100" column="1" bodyfile="src/xbee/xbee_commissioning.c" bodystart="100" bodyend="107"/>
      </memberdef>
      <memberdef kind="function" id="group__xbee__commissioning_1ga337f66d75fea43d5a792ffd534e2f65c" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void xbee_comm_DL</definition>
        <argsstring>(zcl_comm_startup_param_t FAR *p, const void FAR *value_be)</argsstring>
        <name>xbee_comm_DL</name>
        <param>
          <type><ref refid="structzcl__comm__startup__param__t" kindref="compound">zcl_comm_startup_param_t</ref> <ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref> *</type>
          <declname>p</declname>
        </param>
        <param>
          <type>const void <ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref> *</type>
          <declname>value_be</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/xbee/xbee_commissioning.c" line="116" column="1" bodyfile="src/xbee/xbee_commissioning.c" bodystart="116" bodyend="121"/>
      </memberdef>
      <memberdef kind="function" id="group__xbee__commissioning_1ga22b333ec115d26b72abc100fc5d3c431" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void xbee_comm_EO</definition>
        <argsstring>(zcl_comm_startup_param_t FAR *p, const void FAR *value_be)</argsstring>
        <name>xbee_comm_EO</name>
        <param>
          <type><ref refid="structzcl__comm__startup__param__t" kindref="compound">zcl_comm_startup_param_t</ref> <ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref> *</type>
          <declname>p</declname>
        </param>
        <param>
          <type>const void <ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref> *</type>
          <declname>value_be</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/xbee/xbee_commissioning.c" line="123" column="1" bodyfile="src/xbee/xbee_commissioning.c" bodystart="123" bodyend="126"/>
      </memberdef>
      <memberdef kind="function" id="group__xbee__commissioning_1gaec84ef238a638e643c6f8b363630d636" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int xbee_comm_reg_callback</definition>
        <argsstring>(const xbee_cmd_response_t FAR *response)</argsstring>
        <name>xbee_comm_reg_callback</name>
        <param>
          <type>const <ref refid="structxbee__cmd__response__t" kindref="compound">xbee_cmd_response_t</ref> <ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref> *</type>
          <declname>response</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/xbee/xbee_commissioning.c" line="139" column="1" bodyfile="src/xbee/xbee_commissioning.c" bodystart="139" bodyend="195"/>
      </memberdef>
      <memberdef kind="function" id="group__xbee__commissioning_1ga4927f3fc029f50dbbd1ec3e0292e873b" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int xbee_commissioning_query</definition>
        <argsstring>(zcl_comm_state_t *comm, xbee_dev_t *xbee, const char FAR *reg)</argsstring>
        <name>xbee_commissioning_query</name>
        <param>
          <type><ref refid="structzcl__comm__state__t" kindref="compound">zcl_comm_state_t</ref> *</type>
          <declname>comm</declname>
        </param>
        <param>
          <type><ref refid="structxbee__dev__t" kindref="compound">xbee_dev_t</ref> *</type>
          <declname>xbee</declname>
        </param>
        <param>
          <type>const char <ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref> *</type>
          <declname>reg</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/xbee/xbee_commissioning.c" line="197" column="1" bodyfile="src/xbee/xbee_commissioning.c" bodystart="197" bodyend="211"/>
      </memberdef>
      <memberdef kind="function" id="group__xbee__commissioning_1ga9c6e11a80f7544775d5e0d855f840334" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int xbee_commissioning_init</definition>
        <argsstring>(zcl_comm_state_t *comm, xbee_dev_t *xbee)</argsstring>
        <name>xbee_commissioning_init</name>
        <param>
          <type><ref refid="structzcl__comm__state__t" kindref="compound">zcl_comm_state_t</ref> *</type>
          <declname>comm</declname>
        </param>
        <param>
          <type><ref refid="structxbee__dev__t" kindref="compound">xbee_dev_t</ref> *</type>
          <declname>xbee</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/xbee/xbee_commissioning.c" line="214" column="1" bodyfile="src/xbee/xbee_commissioning.c" bodystart="214" bodyend="257"/>
      </memberdef>
      <memberdef kind="function" id="group__xbee__commissioning_1ga6fb796928aa5ff990ca4b62c4893bc2c" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int xbee_commissioning_set</definition>
        <argsstring>(xbee_dev_t *xbee, zcl_comm_startup_param_t *sas)</argsstring>
        <name>xbee_commissioning_set</name>
        <param>
          <type><ref refid="structxbee__dev__t" kindref="compound">xbee_dev_t</ref> *</type>
          <declname>xbee</declname>
        </param>
        <param>
          <type><ref refid="structzcl__comm__startup__param__t" kindref="compound">zcl_comm_startup_param_t</ref> *</type>
          <declname>sas</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/xbee/xbee_commissioning.c" line="263" column="1" bodyfile="src/xbee/xbee_commissioning.c" bodystart="263" bodyend="453"/>
      </memberdef>
      <memberdef kind="function" id="group__xbee__commissioning_1gadd6acaa6c6403e9371358da445f3f194" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void xbee_commissioning_tick</definition>
        <argsstring>(xbee_dev_t *xbee, zcl_comm_state_t *comm)</argsstring>
        <name>xbee_commissioning_tick</name>
        <param>
          <type><ref refid="structxbee__dev__t" kindref="compound">xbee_dev_t</ref> *</type>
          <declname>xbee</declname>
        </param>
        <param>
          <type><ref refid="structzcl__comm__state__t" kindref="compound">zcl_comm_state_t</ref> *</type>
          <declname>comm</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/xbee/xbee_commissioning.c" line="461" column="1" bodyfile="src/xbee/xbee_commissioning.c" bodystart="461" bodyend="591"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
<para>XBee-specific hardware support for ZCL Commissioning Cluster. </para>    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">/*</highlight></codeline>
<codeline lineno="2"><highlight class="comment"><sp/>*<sp/>Copyright<sp/>(c)<sp/>2011-2012<sp/>Digi<sp/>International<sp/>Inc.,</highlight></codeline>
<codeline lineno="3"><highlight class="comment"><sp/>*<sp/>All<sp/>rights<sp/>not<sp/>expressly<sp/>granted<sp/>are<sp/>reserved.</highlight></codeline>
<codeline lineno="4"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="5"><highlight class="comment"><sp/>*<sp/>This<sp/>Source<sp/>Code<sp/>Form<sp/>is<sp/>subject<sp/>to<sp/>the<sp/>terms<sp/>of<sp/>the<sp/>Mozilla<sp/>Public</highlight></codeline>
<codeline lineno="6"><highlight class="comment"><sp/>*<sp/>License,<sp/>v.<sp/>2.0.<sp/>If<sp/>a<sp/>copy<sp/>of<sp/>the<sp/>MPL<sp/>was<sp/>not<sp/>distributed<sp/>with<sp/>this<sp/>file,</highlight></codeline>
<codeline lineno="7"><highlight class="comment"><sp/>*<sp/>You<sp/>can<sp/>obtain<sp/>one<sp/>at<sp/>http://mozilla.org/MPL/2.0/.</highlight></codeline>
<codeline lineno="8"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="9"><highlight class="comment"><sp/>*<sp/>Digi<sp/>International<sp/>Inc.<sp/>11001<sp/>Bren<sp/>Road<sp/>East,<sp/>Minnetonka,<sp/>MN<sp/>55343</highlight></codeline>
<codeline lineno="10"><highlight class="comment"><sp/>*<sp/>=======================================================================</highlight></codeline>
<codeline lineno="11"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="comment">/***<sp/>BeginHeader<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;stdio.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="platform_8h" kindref="compound">xbee/platform.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="zcl__commissioning_8h" kindref="compound">zigbee/zcl_commissioning.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="atcmd_8h" kindref="compound">xbee/atcmd.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="commissioning_8h" kindref="compound">xbee/commissioning.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight><highlight class="comment">/***<sp/>EndHeader<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight><highlight class="comment">/***<sp/>BeginHeader<sp/>xbee_commissioning_get<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight><highlight class="comment">/***<sp/>EndHeader<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="32"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/>void<sp/>(*xbee_comm_fn)(</highlight></codeline>
<codeline lineno="33"><highlight class="normal"><sp/><sp/><sp/><ref refid="structzcl__comm__startup__param__t" kindref="compound">zcl_comm_startup_param_t</ref><sp/><ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref><sp/>*p,</highlight></codeline>
<codeline lineno="34"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref><sp/>*value_be</highlight></codeline>
<codeline lineno="35"><highlight class="normal">);</highlight></codeline>
<codeline lineno="36"><highlight class="normal"></highlight></codeline>
<codeline lineno="37" refid="structxbee__comm__reg__t" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structxbee__comm__reg__t" kindref="compound">xbee_comm_reg_t</ref><sp/>{</highlight></codeline>
<codeline lineno="38" refid="group__xbee__commissioning_1gaa1e66c60bb56acaced6ca2646fd44616" refkind="member"><highlight class="normal"><sp/><sp/><sp/><ref refid="unionxbee__at__cmd__t" kindref="compound">xbee_at_cmd_t</ref><sp/><sp/><ref refid="group__xbee__commissioning_1gaa1e66c60bb56acaced6ca2646fd44616" kindref="member">command</ref>;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="39" refid="group__xbee__commissioning_1ga7cde42d4d91d04d62d5810e84cde3228" refkind="member"><highlight class="normal"><sp/><sp/><sp/>xbee_comm_fn<sp/><sp/><sp/><ref refid="group__xbee__commissioning_1ga7cde42d4d91d04d62d5810e84cde3228" kindref="member">assign_fn</ref>;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="40"><highlight class="normal">}<sp/><ref refid="structxbee__comm__reg__t" kindref="compound">xbee_comm_reg_t</ref>;</highlight></codeline>
<codeline lineno="41"><highlight class="normal"></highlight></codeline>
<codeline lineno="52" refid="group__xbee__commissioning_1ga886012f757de4a74d0c992d3ab04a373" refkind="member"><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="group__xbee__commissioning_1ga886012f757de4a74d0c992d3ab04a373" kindref="member">xbee_comm_SC</ref>(<sp/><ref refid="structzcl__comm__startup__param__t" kindref="compound">zcl_comm_startup_param_t</ref><sp/><ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref><sp/>*p,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref><sp/>*value_be)</highlight></codeline>
<codeline lineno="53"><highlight class="normal">{</highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Bit<sp/>0<sp/>of<sp/>ATSC<sp/>is<sp/>channel<sp/>11,<sp/>so<sp/>shift<sp/>to<sp/>correct<sp/>position<sp/>in<sp/>32-bit<sp/>mask.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/>p-&gt;channel_mask<sp/>=<sp/>(<ref refid="group__hal__dos_1ga09a1e304d66d35dd47daffee9731edaa" kindref="member">uint32_t</ref>)<sp/><ref refid="group__util__byteorder_1gabb9b3120f6457dc04471c134fee1d221" kindref="member">be16toh</ref>(<sp/>xbee_get_unaligned16(<sp/>value_be))<sp/>&lt;&lt;<sp/>11;</highlight></codeline>
<codeline lineno="56"><highlight class="normal">}</highlight></codeline>
<codeline lineno="57"><highlight class="normal"></highlight></codeline>
<codeline lineno="58"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>xbee_comm_OP(<sp/><ref refid="structzcl__comm__startup__param__t" kindref="compound">zcl_comm_startup_param_t</ref><sp/><ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref><sp/>*p,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref><sp/>*value_be)</highlight></codeline>
<codeline lineno="59"><highlight class="normal">{</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="group__hal_1gaae7cb3384b4bbd83726511ccfbd747d3" kindref="member">memcheck</ref>(<sp/>value_be,<sp/>0x00,<sp/>8)<sp/>==<sp/>0)</highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>per<sp/>3.15.2.2.1.2,<sp/>&quot;unspecified&quot;<sp/>should<sp/>be<sp/>all<sp/>Fs<sp/>instead<sp/>of<sp/>0</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>_f_memset(<sp/>&amp;p-&gt;extended_panid,<sp/>0xFF,<sp/>8);</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__util__byteorder_1gad871f144718432cb04f76e79aec80c87" kindref="member">memcpy_betoh</ref>(<sp/>&amp;p-&gt;extended_panid,<sp/>value_be,<sp/>8);</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="69"><highlight class="normal">}</highlight></codeline>
<codeline lineno="70"><highlight class="normal"></highlight></codeline>
<codeline lineno="71"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>xbee_comm_OI(<sp/><ref refid="structzcl__comm__startup__param__t" kindref="compound">zcl_comm_startup_param_t</ref><sp/><ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref><sp/>*p,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref><sp/>*value_be)</highlight></codeline>
<codeline lineno="72"><highlight class="normal">{</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/>p-&gt;panid<sp/>=<sp/><ref refid="group__util__byteorder_1gabb9b3120f6457dc04471c134fee1d221" kindref="member">be16toh</ref>(<sp/>xbee_get_unaligned16(<sp/>value_be));</highlight></codeline>
<codeline lineno="74"><highlight class="normal">}</highlight></codeline>
<codeline lineno="75"><highlight class="normal"></highlight></codeline>
<codeline lineno="76"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>__XBEE_PLATFORM_HCS08</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="77"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/>#pragma<sp/>MESSAGE<sp/>DISABLE<sp/>C5909<sp/><sp/><sp/><sp/>//<sp/>Assignment<sp/>in<sp/>condition<sp/>is<sp/>OK</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="78"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="79"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>xbee_comm_AR(<sp/><ref refid="structzcl__comm__startup__param__t" kindref="compound">zcl_comm_startup_param_t</ref><sp/><ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref><sp/>*p,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref><sp/>*value_be)</highlight></codeline>
<codeline lineno="80"><highlight class="normal">{</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><ref refid="group__hal__dos_1gae1affc9ca37cfb624959c866a73f83c2" kindref="member">uint8_t</ref><sp/>ar;</highlight></codeline>
<codeline lineno="82"><highlight class="normal"></highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/>ar<sp/>=<sp/>*(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="group__hal__dos_1gae1affc9ca37cfb624959c866a73f83c2" kindref="member">uint8_t</ref><sp/><ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref><sp/>*)value_be;</highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>This<sp/>node<sp/>is<sp/>a<sp/>concentrator<sp/>if<sp/>AR<sp/>!=<sp/>0xFF.<sp/><sp/>If<sp/>it&apos;s<sp/>a<sp/>concentrator,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>AR<sp/>is<sp/>the<sp/>discovery<sp/>time.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>(p-&gt;concentrator.flag<sp/>=<sp/>(ar<sp/>!=<sp/>0xFF))<sp/>)</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>p-&gt;concentrator.discovery_time<sp/>=<sp/>ar;</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>discovery<sp/>time<sp/>is<sp/>unknown</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>p-&gt;concentrator.discovery_time<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="95"><highlight class="normal">}</highlight></codeline>
<codeline lineno="96"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>__XBEE_PLATFORM_HCS08</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="97"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/>#pragma<sp/>MESSAGE<sp/>DEFAULT<sp/>C5909<sp/><sp/><sp/><sp/>//<sp/>restore<sp/>C5909<sp/>(Assignment<sp/>in<sp/>condition)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="98"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="99"><highlight class="normal"></highlight></codeline>
<codeline lineno="100"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>xbee_comm_BH(<sp/><ref refid="structzcl__comm__startup__param__t" kindref="compound">zcl_comm_startup_param_t</ref><sp/><ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref><sp/>*p,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref><sp/>*value_be)</highlight></codeline>
<codeline lineno="101"><highlight class="normal">{</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><ref refid="group__hal__dos_1gae1affc9ca37cfb624959c866a73f83c2" kindref="member">uint8_t</ref><sp/>bh;</highlight></codeline>
<codeline lineno="103"><highlight class="normal"></highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>BH<sp/>(broadcast<sp/>hops)<sp/>is<sp/>0,<sp/>use<sp/>maximum<sp/>radius<sp/>(0x1E)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/>bh<sp/>=<sp/>*(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="group__hal__dos_1gae1affc9ca37cfb624959c866a73f83c2" kindref="member">uint8_t</ref><sp/><ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref><sp/>*)value_be;</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/>p-&gt;concentrator.radius<sp/>=<sp/>(bh<sp/>==<sp/>0)<sp/>?<sp/>0x1E<sp/>:<sp/>bh;</highlight></codeline>
<codeline lineno="107"><highlight class="normal">}</highlight></codeline>
<codeline lineno="108"><highlight class="normal"></highlight></codeline>
<codeline lineno="109"><highlight class="normal"></highlight><highlight class="comment">//<sp/>use<sp/>DL<sp/>to<sp/>store<sp/>misc.<sp/>parameters</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="110" refid="structxbee__comm__dl__t" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structxbee__comm__dl__t" kindref="compound">xbee_comm_dl_t</ref><sp/>{</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><ref refid="group__hal__dos_1gae1affc9ca37cfb624959c866a73f83c2" kindref="member">uint8_t</ref><sp/><sp/><sp/><sp/><sp/>b0;</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><ref refid="group__hal__dos_1gae1affc9ca37cfb624959c866a73f83c2" kindref="member">uint8_t</ref><sp/><sp/><sp/><sp/><sp/>b1;</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><ref refid="group__hal__dos_1gae1affc9ca37cfb624959c866a73f83c2" kindref="member">uint8_t</ref><sp/><sp/><sp/><sp/><sp/>b2;</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><ref refid="group__hal__dos_1gae1affc9ca37cfb624959c866a73f83c2" kindref="member">uint8_t</ref><sp/><sp/><sp/><sp/><sp/>startup_control;</highlight></codeline>
<codeline lineno="115"><highlight class="normal">}<sp/><ref refid="structxbee__comm__dl__t" kindref="compound">xbee_comm_dl_t</ref>;</highlight></codeline>
<codeline lineno="116"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>xbee_comm_DL(<sp/><ref refid="structzcl__comm__startup__param__t" kindref="compound">zcl_comm_startup_param_t</ref><sp/><ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref><sp/>*p,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref><sp/>*value_be)</highlight></codeline>
<codeline lineno="117"><highlight class="normal">{</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structxbee__comm__dl__t" kindref="compound">xbee_comm_dl_t</ref><sp/><ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref><sp/>*dl<sp/>=<sp/>value_be;</highlight></codeline>
<codeline lineno="119"><highlight class="normal"></highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/>p-&gt;startup_control<sp/>=<sp/>dl-&gt;startup_control;</highlight></codeline>
<codeline lineno="121"><highlight class="normal">}</highlight></codeline>
<codeline lineno="122"><highlight class="normal"></highlight></codeline>
<codeline lineno="123"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>xbee_comm_EO(<sp/><ref refid="structzcl__comm__startup__param__t" kindref="compound">zcl_comm_startup_param_t</ref><sp/><ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref><sp/>*p,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref><sp/>*value_be)</highlight></codeline>
<codeline lineno="124"><highlight class="normal">{</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/>p-&gt;use_insecure_join<sp/>=<sp/>*(<ref refid="group__hal__dos_1gae1affc9ca37cfb624959c866a73f83c2" kindref="member">uint8_t</ref><sp/><ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref><sp/>*)value_be<sp/>&amp;<sp/>0x01;</highlight></codeline>
<codeline lineno="126"><highlight class="normal">}</highlight></codeline>
<codeline lineno="127"><highlight class="normal"></highlight></codeline>
<codeline lineno="128"><highlight class="normal"></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structxbee__comm__reg__t" kindref="compound">xbee_comm_reg_t</ref><sp/>xbee_comm_regs[]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/>{<sp/>{<sp/>{<sp/></highlight><highlight class="charliteral">&apos;D&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="charliteral">&apos;L&apos;</highlight><highlight class="normal"><sp/>}<sp/>},<sp/>xbee_comm_DL<sp/>},</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/>{<sp/>{<sp/>{<sp/></highlight><highlight class="charliteral">&apos;S&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="charliteral">&apos;C&apos;</highlight><highlight class="normal"><sp/>}<sp/>},<sp/><ref refid="group__xbee__commissioning_1ga886012f757de4a74d0c992d3ab04a373" kindref="member">xbee_comm_SC</ref><sp/>},</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/>{<sp/>{<sp/>{<sp/></highlight><highlight class="charliteral">&apos;A&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="charliteral">&apos;R&apos;</highlight><highlight class="normal"><sp/>}<sp/>},<sp/>xbee_comm_AR<sp/>},</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/>{<sp/>{<sp/>{<sp/></highlight><highlight class="charliteral">&apos;B&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="charliteral">&apos;H&apos;</highlight><highlight class="normal"><sp/>}<sp/>},<sp/>xbee_comm_BH<sp/>},</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/>{<sp/>{<sp/>{<sp/></highlight><highlight class="charliteral">&apos;E&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="charliteral">&apos;O&apos;</highlight><highlight class="normal"><sp/>}<sp/>},<sp/>xbee_comm_EO<sp/>},</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>These<sp/>values<sp/>change<sp/>depending<sp/>on<sp/>what<sp/>network<sp/>we&apos;ve<sp/>joined</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/>{<sp/>{<sp/>{<sp/></highlight><highlight class="charliteral">&apos;O&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="charliteral">&apos;P&apos;</highlight><highlight class="normal"><sp/>}<sp/>},<sp/>xbee_comm_OP<sp/>},</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/>{<sp/>{<sp/>{<sp/></highlight><highlight class="charliteral">&apos;O&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="charliteral">&apos;I&apos;</highlight><highlight class="normal"><sp/>}<sp/>},<sp/>xbee_comm_OI<sp/>},</highlight></codeline>
<codeline lineno="137"><highlight class="normal">};</highlight></codeline>
<codeline lineno="138"><highlight class="normal"></highlight></codeline>
<codeline lineno="139"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>xbee_comm_reg_callback(<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structxbee__cmd__response__t" kindref="compound">xbee_cmd_response_t</ref><sp/><ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref><sp/>*response)</highlight></codeline>
<codeline lineno="140"><highlight class="normal">{</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structxbee__comm__reg__t" kindref="compound">xbee_comm_reg_t</ref><sp/>*reg;</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><ref refid="structzcl__comm__state__t" kindref="compound">zcl_comm_state_t</ref><sp/><ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref><sp/>*comm<sp/>=<sp/>response-&gt;context;</highlight></codeline>
<codeline lineno="143"><highlight class="normal"></highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/>uint_fast8_t<sp/><sp/><sp/>i;</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><ref refid="group__hal__dos_1ga2140805d08462d474b82ddc8d1c2f3e6" kindref="member">int16_t</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>request;</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><ref refid="group__hal__dos_1ga04dd5074964518403bf944f2b240a5f8" kindref="member">bool_t</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>found;</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><ref refid="group__hal__dos_1ga5a8b2dc9e45a9ee81a94ef304fb62505" kindref="member">uint16_t</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__xbee__commissioning_1gaa1e66c60bb56acaced6ca2646fd44616" kindref="member">command</ref>;</highlight></codeline>
<codeline lineno="148"><highlight class="normal"></highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(response-&gt;flags<sp/>&amp;<sp/>XBEE_CMD_RESP_FLAG_TIMEOUT)</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="group__xbee__atcmd_1gad51a6fee7843df5a5bfd6f3957465426" kindref="member">XBEE_ATCMD_DONE</ref>;<sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>give<sp/>up</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="153"><highlight class="normal"></highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/>request<sp/>=<sp/>response-&gt;handle;</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/>command<sp/>=<sp/>response-&gt;command.w;</highlight></codeline>
<codeline lineno="156"><highlight class="normal"></highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/>reg<sp/>=<sp/>xbee_comm_regs;</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/>found<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/><ref refid="group__hal_1ga2fb602f8a5b3533a57c2c4b92f248569" kindref="member">_TABLE_ENTRIES</ref>(xbee_comm_regs);<sp/>i;<sp/>++reg,<sp/>--i)</highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(found)</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Found<sp/>a<sp/>match<sp/>on<sp/>last<sp/>pass<sp/>through<sp/>loop,<sp/>this<sp/>is<sp/>the<sp/>next<sp/>register</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>to<sp/>request.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga06181e54a87d90c30108360d6b433323" kindref="member">xbee_cmd_set_command</ref>(<sp/>response-&gt;handle,<sp/>reg-&gt;<ref refid="group__xbee__commissioning_1gaa1e66c60bb56acaced6ca2646fd44616" kindref="member">command</ref>.str);</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga2c58eedef60b41dd30ae1f6b475606a8" kindref="member">xbee_cmd_send</ref>(<sp/>request);</highlight></codeline>
<codeline lineno="167"><highlight class="normal"></highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="group__xbee__atcmd_1ga9a5078393806d67903c87b3c82597fb1" kindref="member">XBEE_ATCMD_REUSE</ref>;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>keep<sp/>this<sp/>request<sp/>alive</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(command<sp/>==<sp/>reg-&gt;<ref refid="group__xbee__commissioning_1gaa1e66c60bb56acaced6ca2646fd44616" kindref="member">command</ref>.w)</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>found<sp/>=<sp/>TRUE;</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>found<sp/>it<sp/>in<sp/>the<sp/>list,<sp/>copy<sp/>the<sp/>response<sp/>if<sp/>status<sp/>is<sp/>success</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>((response-&gt;flags<sp/>&amp;<sp/>XBEE_CMD_RESP_MASK_STATUS)</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>==<sp/>XBEE_AT_RESP_SUCCESS)</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>reg-&gt;<ref refid="group__xbee__commissioning_1ga7cde42d4d91d04d62d5810e84cde3228" kindref="member">assign_fn</ref>(<sp/>&amp;comm-&gt;sas,<sp/>response-&gt;value_bytes);</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="181"><highlight class="normal"></highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>done<sp/>with<sp/>lookups,<sp/>advance<sp/>state</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(comm-&gt;state<sp/>==<sp/><ref refid="group__zcl__commissioning_1ga44abce1dcc61c33053dffe8641e4b167" kindref="member">ZCL_COMM_STATE_LOADING</ref>)</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>comm-&gt;state<sp/>=<sp/><ref refid="group__zcl__commissioning_1ga03c5eb470ac12387be9e3e48953750f5" kindref="member">ZCL_COMM_STATE_STARTUP</ref>;</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(comm-&gt;state<sp/>==<sp/><ref refid="group__zcl__commissioning_1gae9523cf195068a92283ba0d44424e105" kindref="member">ZCL_COMM_STATE_REFRESH</ref>)</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>comm-&gt;state<sp/>=<sp/><ref refid="group__zcl__commissioning_1ga4d8a61e021ef1c4826b18d6eb356c96e" kindref="member">ZCL_COMM_STATE_JOINED</ref>;</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="191"><highlight class="normal"></highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Error<sp/>or<sp/>last<sp/>command,<sp/>tell<sp/>dispatcher<sp/>that<sp/>we&apos;re<sp/>done<sp/>and<sp/>it<sp/>can<sp/>delete</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>request<sp/>entry.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="group__xbee__atcmd_1gad51a6fee7843df5a5bfd6f3957465426" kindref="member">XBEE_ATCMD_DONE</ref>;</highlight></codeline>
<codeline lineno="195"><highlight class="normal">}</highlight></codeline>
<codeline lineno="196"><highlight class="normal"></highlight></codeline>
<codeline lineno="197"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>xbee_commissioning_query(<sp/><ref refid="structzcl__comm__state__t" kindref="compound">zcl_comm_state_t</ref><sp/>*comm,<sp/><ref refid="structxbee__dev__t" kindref="compound">xbee_dev_t</ref><sp/>*xbee,</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/><ref refid="group__hal_1gaef060b3456fdcc093a7210a762d5f2ed" kindref="member">FAR</ref><sp/>*reg)</highlight></codeline>
<codeline lineno="199"><highlight class="normal">{</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><ref refid="group__hal__dos_1ga2140805d08462d474b82ddc8d1c2f3e6" kindref="member">int16_t</ref><sp/>request;</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>error;</highlight></codeline>
<codeline lineno="202"><highlight class="normal"></highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/>request<sp/>=<sp/><ref refid="group__xbee__atcmd_1gab73aaf873be6f9e515dcd65748a7f21c" kindref="member">xbee_cmd_create</ref>(<sp/>xbee,<sp/>reg);</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(request<sp/>&lt;<sp/>0)</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>request;</highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/>error<sp/>=<sp/><ref refid="group__xbee__atcmd_1ga0a5d2e2e87743061c46abd53e379e014" kindref="member">xbee_cmd_set_callback</ref>(<sp/>request,<sp/>xbee_comm_reg_callback,<sp/>comm);</highlight></codeline>
<codeline lineno="209"><highlight class="normal"></highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>error<sp/>?<sp/>error<sp/>:<sp/><ref refid="group__xbee__atcmd_1ga2c58eedef60b41dd30ae1f6b475606a8" kindref="member">xbee_cmd_send</ref>(<sp/>request);</highlight></codeline>
<codeline lineno="211"><highlight class="normal">}</highlight></codeline>
<codeline lineno="212"><highlight class="normal"></highlight></codeline>
<codeline lineno="213"><highlight class="normal"></highlight><highlight class="comment">//<sp/>populate<sp/>zcl_comm_startup_param<sp/>by<sp/>reading<sp/>values<sp/>from<sp/>XBee</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="214"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>xbee_commissioning_init(<sp/><ref refid="structzcl__comm__state__t" kindref="compound">zcl_comm_state_t</ref><sp/>*comm,<sp/><ref refid="structxbee__dev__t" kindref="compound">xbee_dev_t</ref><sp/>*xbee)</highlight></codeline>
<codeline lineno="215"><highlight class="normal">{</highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Initialize<sp/>the<sp/>startup<sp/>attributes...</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/>zcl_comm_sas_init(<sp/>&amp;comm-&gt;sas);</highlight></codeline>
<codeline lineno="218"><highlight class="normal"></highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>...and<sp/>set<sp/>the<sp/>rest<sp/>of<sp/>the<sp/>structure<sp/>to<sp/>0</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/>memset(<sp/>&amp;comm-&gt;flags,<sp/>0,</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<sp/><ref refid="structzcl__comm__state__t" kindref="compound">zcl_comm_state_t</ref>)<sp/>-<sp/>offsetof(<sp/><ref refid="structzcl__comm__state__t" kindref="compound">zcl_comm_state_t</ref>,<sp/>flags));</highlight></codeline>
<codeline lineno="222"><highlight class="normal"></highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/>comm-&gt;sas.scan_attempts<sp/>=<sp/>XBEE_COMM_SCAN_ATTEMPTS;</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/>comm-&gt;sas.time_between_scans<sp/>=<sp/>XBEE_COMM_TIME_BETWEEN_SCANS;</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/>comm-&gt;sas.rejoin_interval<sp/>=<sp/>XBEE_COMM_REJOIN_INTERVAL;</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/>comm-&gt;sas.max_rejoin_interval<sp/>=<sp/>XBEE_COMM_MAX_REJOIN_INTERVAL;</highlight></codeline>
<codeline lineno="227"><highlight class="normal"></highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>((<ref refid="group__hal__dos_1ga5a8b2dc9e45a9ee81a94ef304fb62505" kindref="member">uint16_t</ref>)<sp/>xbee-&gt;<ref refid="group__xbee__device_1gac8e0f35fdeff288dd1a7b4f49754c9b2" kindref="member">firmware_version</ref></highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<sp/>(XBEE_PROTOCOL_MASK<sp/>|<sp/>XBEE_NODETYPE_MASK))</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>XBEE_PROTOCOL_ZB_S2C:<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>40xx</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>XBEE_PROTOCOL_SE_S2C<sp/>|<sp/>XBEE_NODETYPE_COORD:<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>51xx</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>S2C<sp/>hardware<sp/>can<sp/>be<sp/>any<sp/>node<sp/>type</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>comm-&gt;flags<sp/>=<sp/><ref refid="group__zcl__commissioning_1ga31a1726685fa4acfd6e27a00ba715e5d" kindref="member">ZCL_COMM_FLAG_COORDINATOR_OK</ref></highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/><ref refid="group__zcl__commissioning_1ga3f21ae380281a600718338c090dd7176" kindref="member">ZCL_COMM_FLAG_ROUTER_OK</ref></highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/><ref refid="group__zcl__commissioning_1gaccf2d6e723514ff49e123264a3cbde5a" kindref="member">ZCL_COMM_FLAG_ENDDEV_OK</ref>;</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="238"><highlight class="normal"></highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>XBEE_PROTOCOL_ZB<sp/>|<sp/>XBEE_NODETYPE_COORD:<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>21xx</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>XBEE_PROTOCOL_SMARTENERGY<sp/>|<sp/>XBEE_NODETYPE_COORD:<sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>31xx</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>comm-&gt;flags<sp/>=<sp/><ref refid="group__zcl__commissioning_1ga31a1726685fa4acfd6e27a00ba715e5d" kindref="member">ZCL_COMM_FLAG_COORDINATOR_OK</ref>;</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="243"><highlight class="normal"></highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>XBEE_PROTOCOL_ZB<sp/>|<sp/>XBEE_NODETYPE_ROUTER:<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>23xx</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>XBEE_PROTOCOL_SMARTENERGY<sp/>|<sp/>XBEE_NODETYPE_ROUTER:<sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>33xx</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>comm-&gt;flags<sp/>=<sp/><ref refid="group__zcl__commissioning_1ga3f21ae380281a600718338c090dd7176" kindref="member">ZCL_COMM_FLAG_ROUTER_OK</ref>;</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="248"><highlight class="normal"></highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>XBEE_PROTOCOL_ZB<sp/>|<sp/>XBEE_NODETYPE_ENDDEV:<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>29xx</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>XBEE_PROTOCOL_SMARTENERGY<sp/>|<sp/>XBEE_NODETYPE_ENDDEV:<sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>39xx</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>comm-&gt;flags<sp/>=<sp/><ref refid="group__zcl__commissioning_1gaccf2d6e723514ff49e123264a3cbde5a" kindref="member">ZCL_COMM_FLAG_ENDDEV_OK</ref>;</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="254"><highlight class="normal"></highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>load<sp/>all<sp/>commissioning<sp/>registers<sp/>from<sp/>the<sp/>XBee</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>xbee_commissioning_query(<sp/>comm,<sp/>xbee,<sp/>xbee_comm_regs[0].<ref refid="group__xbee__commissioning_1gaa1e66c60bb56acaced6ca2646fd44616" kindref="member">command</ref>.str);</highlight></codeline>
<codeline lineno="257"><highlight class="normal">}</highlight></codeline>
<codeline lineno="258"><highlight class="normal"></highlight></codeline>
<codeline lineno="259"><highlight class="normal"></highlight></codeline>
<codeline lineno="260"><highlight class="normal"></highlight><highlight class="comment">/***<sp/>BeginHeader<sp/>xbee_commissioning_set<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="261"><highlight class="normal"></highlight><highlight class="comment">/***<sp/>EndHeader<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="262"><highlight class="normal"></highlight><highlight class="comment">//<sp/>configure<sp/>XBee<sp/>with<sp/>options<sp/>stored<sp/>in<sp/>zcl_comm_startup_param_t</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="263"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>xbee_commissioning_set(<sp/><ref refid="structxbee__dev__t" kindref="compound">xbee_dev_t</ref><sp/>*xbee,<sp/><ref refid="structzcl__comm__startup__param__t" kindref="compound">zcl_comm_startup_param_t</ref><sp/>*sas)</highlight></codeline>
<codeline lineno="264"><highlight class="normal">{</highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><ref refid="group__hal__dos_1ga04dd5074964518403bf944f2b240a5f8" kindref="member">bool_t</ref><sp/>encrypt,<sp/>coord;</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><ref refid="structxbee__comm__dl__t" kindref="compound">xbee_comm_dl_t</ref><sp/>dl;</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><ref refid="group__hal__dos_1gae1affc9ca37cfb624959c866a73f83c2" kindref="member">uint8_t</ref><sp/>temp_u8;</highlight></codeline>
<codeline lineno="268"><highlight class="normal"></highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Create<sp/>macros<sp/>for<sp/>swapping<sp/>byte<sp/>order<sp/>to<sp/>big-endian<sp/>for<sp/>setting</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>parameter<sp/>of<sp/>AT<sp/>request,<sp/>and<sp/>for<sp/>dumping<sp/>data<sp/>to<sp/>stdout.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="271"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/>#if<sp/>BYTE_ORDER<sp/>==<sp/>LITTLE_ENDIAN</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__hal__dos_1gae1affc9ca37cfb624959c866a73f83c2" kindref="member">uint8_t</ref><sp/><sp/>buffer[8];<sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>used<sp/>for<sp/>swapping<sp/>byte<sp/>order<sp/>to<sp/>big-endian</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="273"><highlight class="normal"></highlight></codeline>
<codeline lineno="274"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/>#define<sp/>_set_param_bytes(<sp/>req,<sp/>data,<sp/>len)<sp/>\</highlight></codeline>
<codeline lineno="275"><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(<sp/><sp/>memcpy_htobe(<sp/>buffer,<sp/>data,<sp/>len),<sp/><sp/><sp/>\</highlight></codeline>
<codeline lineno="276"><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>xbee_cmd_set_param_bytes(<sp/>req,<sp/>buffer,<sp/>len)<sp/>)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="277"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/>#define<sp/>_hex_dump(<sp/>data,<sp/>len)<sp/>\</highlight></codeline>
<codeline lineno="278"><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hex_dump(<sp/>buffer,<sp/>len,<sp/>HEX_DUMP_FLAG_NONE)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="279"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/>#else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="280"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/>#define<sp/>_set_param_bytes(<sp/>req,<sp/>data,<sp/>len)<sp/>\</highlight></codeline>
<codeline lineno="281"><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>xbee_cmd_set_param_bytes(<sp/>req,<sp/>data,<sp/>len)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="282"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/>#define<sp/>_hex_dump(<sp/>data,<sp/>len)<sp/>\</highlight></codeline>
<codeline lineno="283"><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hex_dump(<sp/>data,<sp/>len,<sp/>HEX_DUMP_FLAG_NONE)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="284"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/>#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="285"><highlight class="normal"></highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><ref refid="group__hal__dos_1ga2140805d08462d474b82ddc8d1c2f3e6" kindref="member">int16_t</ref><sp/>request;</highlight></codeline>
<codeline lineno="287"><highlight class="normal"></highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Since<sp/>we<sp/>aren&apos;t<sp/>using<sp/>a<sp/>callback<sp/>for<sp/>the<sp/>request,<sp/>we<sp/>can<sp/>re-use<sp/>it<sp/>for</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>setting<sp/>all<sp/>of<sp/>the<sp/>necessary<sp/>parameters.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="290"><highlight class="normal"></highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/>request<sp/>=<sp/><ref refid="group__xbee__atcmd_1gab73aaf873be6f9e515dcd65748a7f21c" kindref="member">xbee_cmd_create</ref>(<sp/>xbee,<sp/></highlight><highlight class="stringliteral">&quot;ID&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(request<sp/>&lt;<sp/>0)</highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="294"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/>#ifdef<sp/>XBEE_COMMISSIONING_VERBOSE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>printf(<sp/></highlight><highlight class="stringliteral">&quot;%s:<sp/>can&apos;t<sp/>create<sp/>command<sp/>handle<sp/>(error<sp/>%d)\n&quot;</highlight><highlight class="normal">,<sp/>__FUNCTION__,</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>request);</highlight></codeline>
<codeline lineno="297"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/>#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>request;</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="300"><highlight class="normal"></highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>queue<sp/>all<sp/>changes<sp/>until<sp/>the<sp/>last<sp/>one<sp/>so<sp/>they&apos;re<sp/>applied<sp/>in<sp/>a<sp/>single<sp/>batch</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1gad2cc44803cc53ada37df4557313e120b" kindref="member">xbee_cmd_set_flags</ref>(<sp/>request,</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="atcmd_8h_1a5eaa2d8338dc2a6573754f6726f54e86" kindref="member">XBEE_CMD_FLAG_QUEUE_CHANGE</ref><sp/>|<sp/><ref refid="atcmd_8h_1acac52973ec9c2518fe82619a75b2b854" kindref="member">XBEE_CMD_FLAG_REUSE_HANDLE</ref>);</highlight></codeline>
<codeline lineno="304"><highlight class="normal"></highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="group__hal_1gaae7cb3384b4bbd83726511ccfbd747d3" kindref="member">memcheck</ref>(<sp/>&amp;sas-&gt;extended_panid,<sp/>0xFF,<sp/>8)<sp/>==<sp/>0)</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>map<sp/>Commissioning<sp/>Cluster&apos;s<sp/>&quot;unspecified&quot;<sp/>(all<sp/>F&apos;s)<sp/>to<sp/>XBee&apos;s<sp/>(0)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga6bd558a2d03eafe29b176f598d76ffd6" kindref="member">xbee_cmd_set_param_bytes</ref>(<sp/>request,<sp/><ref refid="group__wpan__types_1ga014f9d0857312b6a7f80ee10ecfd0935" kindref="member">WPAN_IEEE_ADDR_ALL_ZEROS</ref>,<sp/>8);</highlight></codeline>
<codeline lineno="309"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#ifdef<sp/>XBEE_COMMISSIONING_VERBOSE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>printf(<sp/></highlight><highlight class="stringliteral">&quot;%s:<sp/>setting<sp/>%s=%u\n&quot;</highlight><highlight class="normal">,<sp/>__FUNCTION__,<sp/></highlight><highlight class="stringliteral">&quot;ID&quot;</highlight><highlight class="normal">,<sp/>0);</highlight></codeline>
<codeline lineno="311"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>_set_param_bytes(<sp/>request,<sp/>&amp;sas-&gt;extended_panid,<sp/>8);</highlight></codeline>
<codeline lineno="316"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/>#ifdef<sp/>XBEE_COMMISSIONING_VERBOSE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>printf(<sp/></highlight><highlight class="stringliteral">&quot;%s:<sp/>setting<sp/>%s=\n&quot;</highlight><highlight class="normal">,<sp/>__FUNCTION__,<sp/></highlight><highlight class="stringliteral">&quot;ID&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>_hex_dump(<sp/>&amp;sas-&gt;extended_panid,<sp/>8);</highlight></codeline>
<codeline lineno="319"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/>#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga2c58eedef60b41dd30ae1f6b475606a8" kindref="member">xbee_cmd_send</ref>(<sp/>request);</highlight></codeline>
<codeline lineno="322"><highlight class="normal"></highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga06181e54a87d90c30108360d6b433323" kindref="member">xbee_cmd_set_command</ref>(<sp/>request,<sp/></highlight><highlight class="stringliteral">&quot;II&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga4295dde3673b07f41e569e333abd9730" kindref="member">xbee_cmd_set_param</ref>(<sp/>request,<sp/>sas-&gt;panid);</highlight></codeline>
<codeline lineno="325"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/>#ifdef<sp/>XBEE_COMMISSIONING_VERBOSE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>printf(<sp/></highlight><highlight class="stringliteral">&quot;%s:<sp/>setting<sp/>%s=%04X\n&quot;</highlight><highlight class="normal">,<sp/>__FUNCTION__,<sp/></highlight><highlight class="stringliteral">&quot;II&quot;</highlight><highlight class="normal">,<sp/>sas-&gt;panid);</highlight></codeline>
<codeline lineno="327"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/>#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga2c58eedef60b41dd30ae1f6b475606a8" kindref="member">xbee_cmd_send</ref>(<sp/>request);</highlight></codeline>
<codeline lineno="329"><highlight class="normal"></highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga06181e54a87d90c30108360d6b433323" kindref="member">xbee_cmd_set_command</ref>(<sp/>request,<sp/></highlight><highlight class="stringliteral">&quot;DL&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>By<sp/>storing<sp/>values<sp/>in<sp/>the<sp/>low<sp/>bytes<sp/>of<sp/>DL,<sp/>we<sp/>can<sp/>get<sp/>away<sp/>with<sp/>setting</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>and<sp/>sending<sp/>just<sp/>part<sp/>of<sp/>the<sp/>structure<sp/>and<sp/>having<sp/>the<sp/>top<sp/>bytes<sp/>get</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>set<sp/>to<sp/>0.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/>dl.startup_control<sp/>=<sp/>sas-&gt;startup_control;</highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga6bd558a2d03eafe29b176f598d76ffd6" kindref="member">xbee_cmd_set_param_bytes</ref>(<sp/>request,<sp/>&amp;dl.startup_control,<sp/>1);</highlight></codeline>
<codeline lineno="336"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/>#ifdef<sp/>XBEE_COMMISSIONING_VERBOSE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>printf(<sp/></highlight><highlight class="stringliteral">&quot;%s:<sp/>setting<sp/>%s=0x%08x\n&quot;</highlight><highlight class="normal">,<sp/>__FUNCTION__,<sp/></highlight><highlight class="stringliteral">&quot;DL&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dl.startup_control);</highlight></codeline>
<codeline lineno="339"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/>#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga2c58eedef60b41dd30ae1f6b475606a8" kindref="member">xbee_cmd_send</ref>(<sp/>request);</highlight></codeline>
<codeline lineno="341"><highlight class="normal"></highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(dl.startup_control<sp/>==<sp/>ZCL_COMM_STARTUP_COORDINATOR)</highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>coord<sp/>=<sp/>TRUE;</highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(dl.startup_control<sp/>==<sp/>ZCL_COMM_STARTUP_JOINED)</highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>coord<sp/>=<sp/>(sas-&gt;short_address<sp/>==<sp/><ref refid="group__wpan__types_1ga5158cbab6c4139bd77d1d3f80d9071b2" kindref="member">WPAN_NET_ADDR_COORDINATOR</ref>);</highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>coord<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga06181e54a87d90c30108360d6b433323" kindref="member">xbee_cmd_set_command</ref>(<sp/>request,<sp/></highlight><highlight class="stringliteral">&quot;CE&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga4295dde3673b07f41e569e333abd9730" kindref="member">xbee_cmd_set_param</ref>(<sp/>request,<sp/>coord);</highlight></codeline>
<codeline lineno="356"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/>#ifdef<sp/>XBEE_COMMISSIONING_VERBOSE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>printf(<sp/></highlight><highlight class="stringliteral">&quot;%s:<sp/>setting<sp/>%s=%u\n&quot;</highlight><highlight class="normal">,<sp/>__FUNCTION__,<sp/></highlight><highlight class="stringliteral">&quot;CE&quot;</highlight><highlight class="normal">,<sp/>coord);</highlight></codeline>
<codeline lineno="358"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/>#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga2c58eedef60b41dd30ae1f6b475606a8" kindref="member">xbee_cmd_send</ref>(<sp/>request);</highlight></codeline>
<codeline lineno="360"><highlight class="normal"></highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga06181e54a87d90c30108360d6b433323" kindref="member">xbee_cmd_set_command</ref>(<sp/>request,<sp/></highlight><highlight class="stringliteral">&quot;EO&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>take<sp/>insecure<sp/>join<sp/>setting<sp/>and<sp/>set<sp/>the<sp/>&quot;use<sp/>trust<sp/>center&quot;<sp/>bit</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga4295dde3673b07f41e569e333abd9730" kindref="member">xbee_cmd_set_param</ref>(<sp/>request,<sp/>sas-&gt;use_insecure_join<sp/>|<sp/>0x02);</highlight></codeline>
<codeline lineno="364"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/>#ifdef<sp/>XBEE_COMMISSIONING_VERBOSE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>printf(<sp/></highlight><highlight class="stringliteral">&quot;%s:<sp/>setting<sp/>%s=%u\n&quot;</highlight><highlight class="normal">,<sp/>__FUNCTION__,<sp/></highlight><highlight class="stringliteral">&quot;EO&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sas-&gt;use_insecure_join);</highlight></codeline>
<codeline lineno="367"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/>#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga2c58eedef60b41dd30ae1f6b475606a8" kindref="member">xbee_cmd_send</ref>(<sp/>request);</highlight></codeline>
<codeline lineno="369"><highlight class="normal"></highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>network<sp/>key<sp/>has<sp/>changed,<sp/>set<sp/>it<sp/>on<sp/>the<sp/>XBee</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Note<sp/>that<sp/>we<sp/>can<sp/>only<sp/>set<sp/>NK<sp/>on<sp/>an<sp/>XBee<sp/>coordinator</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="group__hal_1gaae7cb3384b4bbd83726511ccfbd747d3" kindref="member">memcheck</ref>(<sp/>sas-&gt;network_key_le,<sp/>0xFF,</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(sas-&gt;network_key_le))<sp/>!=<sp/>0)</highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>On<sp/>the<sp/>XBee,<sp/>a<sp/>network<sp/>key<sp/>of<sp/>all<sp/>zeros<sp/>means<sp/>&quot;pick<sp/>a<sp/>random<sp/>key&quot;.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Since<sp/>we&apos;re<sp/>disabling<sp/>network<sp/>encryption,<sp/>it&apos;s<sp/>OK<sp/>to<sp/>erase<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>current<sp/>key.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga06181e54a87d90c30108360d6b433323" kindref="member">xbee_cmd_set_command</ref>(<sp/>request,<sp/></highlight><highlight class="stringliteral">&quot;NK&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga6bd558a2d03eafe29b176f598d76ffd6" kindref="member">xbee_cmd_set_param_bytes</ref>(<sp/>request,<sp/>&amp;sas-&gt;network_key_le,<sp/>16);</highlight></codeline>
<codeline lineno="380"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/>#ifdef<sp/>XBEE_COMMISSIONING_VERBOSE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>printf(<sp/></highlight><highlight class="stringliteral">&quot;%s:<sp/>setting<sp/>%s=\n&quot;</highlight><highlight class="normal">,<sp/>__FUNCTION__,<sp/></highlight><highlight class="stringliteral">&quot;NK&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__util_1gaa321236a0cb6f4e0dad592fdf1b550d2" kindref="member">hex_dump</ref>(<sp/>&amp;sas-&gt;network_key_le,<sp/>16,<sp/><ref refid="group__hal_1gae60f842ae8bc3cc952cdeece611670d5" kindref="member">HEX_DUMP_FLAG_NONE</ref>);</highlight></codeline>
<codeline lineno="383"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/>#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga2c58eedef60b41dd30ae1f6b475606a8" kindref="member">xbee_cmd_send</ref>(<sp/>request);</highlight></codeline>
<codeline lineno="385"><highlight class="normal"></highlight></codeline>
<codeline lineno="386"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>network<sp/>key<sp/>has<sp/>been<sp/>copied<sp/>to<sp/>XBee,<sp/>set<sp/>it<sp/>to<sp/>marker<sp/>value</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>memset(<sp/>sas-&gt;network_key_le,<sp/>0xFF,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(sas-&gt;network_key_le));</highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="389"><highlight class="normal"></highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>link<sp/>key<sp/>has<sp/>changed,<sp/>set<sp/>it<sp/>on<sp/>the<sp/>XBee</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="group__hal_1gaae7cb3384b4bbd83726511ccfbd747d3" kindref="member">memcheck</ref>(<sp/>sas-&gt;preconfig_link_key_le,<sp/>0xFF,</highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(sas-&gt;preconfig_link_key_le))<sp/>!=<sp/>0)</highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>queue<sp/>change<sp/>to<sp/>KY<sp/>(Preconfigured<sp/>Link<sp/>Key)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga06181e54a87d90c30108360d6b433323" kindref="member">xbee_cmd_set_command</ref>(<sp/>request,<sp/></highlight><highlight class="stringliteral">&quot;KY&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga6bd558a2d03eafe29b176f598d76ffd6" kindref="member">xbee_cmd_set_param_bytes</ref>(<sp/>request,<sp/>&amp;sas-&gt;preconfig_link_key_le,<sp/>16);</highlight></codeline>
<codeline lineno="397"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/>#ifdef<sp/>XBEE_COMMISSIONING_VERBOSE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>printf(<sp/></highlight><highlight class="stringliteral">&quot;%s:<sp/>setting<sp/>%s=\n&quot;</highlight><highlight class="normal">,<sp/>__FUNCTION__,<sp/></highlight><highlight class="stringliteral">&quot;KY&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__util_1gaa321236a0cb6f4e0dad592fdf1b550d2" kindref="member">hex_dump</ref>(<sp/>&amp;sas-&gt;preconfig_link_key_le,<sp/>16,<sp/><ref refid="group__hal_1gae60f842ae8bc3cc952cdeece611670d5" kindref="member">HEX_DUMP_FLAG_NONE</ref>);</highlight></codeline>
<codeline lineno="400"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/>#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga2c58eedef60b41dd30ae1f6b475606a8" kindref="member">xbee_cmd_send</ref>(<sp/>request);</highlight></codeline>
<codeline lineno="402"><highlight class="normal"></highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>We&apos;re<sp/>interpreting<sp/>the<sp/>Commissioning<sp/>Cluster<sp/>spec<sp/>such<sp/>that<sp/>a</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>link<sp/>key<sp/>value<sp/>of<sp/>all<sp/>zeros<sp/>means<sp/>&quot;disable<sp/>network<sp/>encryption&quot;.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>spec<sp/>says<sp/>it<sp/>&quot;indicates<sp/>that<sp/>the<sp/>key<sp/>is<sp/>unspecified.&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>encrypt<sp/>=<sp/>(<ref refid="group__hal_1gaae7cb3384b4bbd83726511ccfbd747d3" kindref="member">memcheck</ref>(<sp/>sas-&gt;preconfig_link_key_le,<sp/>0,</highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(sas-&gt;preconfig_link_key_le))<sp/>!=<sp/>0);</highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga06181e54a87d90c30108360d6b433323" kindref="member">xbee_cmd_set_command</ref>(<sp/>request,<sp/></highlight><highlight class="stringliteral">&quot;EE&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga4295dde3673b07f41e569e333abd9730" kindref="member">xbee_cmd_set_param</ref>(<sp/>request,<sp/>encrypt);</highlight></codeline>
<codeline lineno="410"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#ifdef<sp/>XBEE_COMMISSIONING_VERBOSE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>printf(<sp/></highlight><highlight class="stringliteral">&quot;%s:<sp/>setting<sp/>%s=%u\n&quot;</highlight><highlight class="normal">,<sp/>__FUNCTION__,<sp/></highlight><highlight class="stringliteral">&quot;EE&quot;</highlight><highlight class="normal">,<sp/>encrypt);</highlight></codeline>
<codeline lineno="412"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga2c58eedef60b41dd30ae1f6b475606a8" kindref="member">xbee_cmd_send</ref>(<sp/>request);</highlight></codeline>
<codeline lineno="414"><highlight class="normal"></highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>link<sp/>key<sp/>has<sp/>been<sp/>copied<sp/>to<sp/>the<sp/>XBee,<sp/>set<sp/>it<sp/>to<sp/>the<sp/>marker<sp/>value</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>memset(<sp/>sas-&gt;preconfig_link_key_le,<sp/>0xFF,</highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(sas-&gt;preconfig_link_key_le));</highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="419"><highlight class="normal"></highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga06181e54a87d90c30108360d6b433323" kindref="member">xbee_cmd_set_command</ref>(<sp/>request,<sp/></highlight><highlight class="stringliteral">&quot;BH&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga4295dde3673b07f41e569e333abd9730" kindref="member">xbee_cmd_set_param</ref>(<sp/>request,<sp/>sas-&gt;concentrator.radius);</highlight></codeline>
<codeline lineno="422"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/>#ifdef<sp/>XBEE_COMMISSIONING_VERBOSE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>printf(<sp/></highlight><highlight class="stringliteral">&quot;%s:<sp/>setting<sp/>%s=%u\n&quot;</highlight><highlight class="normal">,<sp/>__FUNCTION__,<sp/></highlight><highlight class="stringliteral">&quot;BH&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sas-&gt;concentrator.radius);</highlight></codeline>
<codeline lineno="425"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/>#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga2c58eedef60b41dd30ae1f6b475606a8" kindref="member">xbee_cmd_send</ref>(<sp/>request);</highlight></codeline>
<codeline lineno="427"><highlight class="normal"></highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga06181e54a87d90c30108360d6b433323" kindref="member">xbee_cmd_set_command</ref>(<sp/>request,<sp/></highlight><highlight class="stringliteral">&quot;AR&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/>temp_u8<sp/>=<sp/>sas-&gt;concentrator.flag<sp/>?<sp/>sas-&gt;concentrator.discovery_time<sp/>:<sp/>0xFF;</highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga4295dde3673b07f41e569e333abd9730" kindref="member">xbee_cmd_set_param</ref>(<sp/>request,<sp/>temp_u8);</highlight></codeline>
<codeline lineno="431"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/>#ifdef<sp/>XBEE_COMMISSIONING_VERBOSE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>printf(<sp/></highlight><highlight class="stringliteral">&quot;%s:<sp/>setting<sp/>%s=0x%02X\n&quot;</highlight><highlight class="normal">,<sp/>__FUNCTION__,<sp/></highlight><highlight class="stringliteral">&quot;AR&quot;</highlight><highlight class="normal">,<sp/>temp_u8);</highlight></codeline>
<codeline lineno="433"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/>#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga2c58eedef60b41dd30ae1f6b475606a8" kindref="member">xbee_cmd_send</ref>(<sp/>request);</highlight></codeline>
<codeline lineno="435"><highlight class="normal"></highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>set<sp/>SC<sp/>(Scan<sp/>Channels)<sp/>and<sp/>apply<sp/>all<sp/>other<sp/>changes</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga06181e54a87d90c30108360d6b433323" kindref="member">xbee_cmd_set_command</ref>(<sp/>request,<sp/></highlight><highlight class="stringliteral">&quot;SC&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga0828601d6b2735ee9f2ebf408d12c05c" kindref="member">xbee_cmd_clear_flags</ref>(<sp/>request,<sp/><ref refid="atcmd_8h_1a5eaa2d8338dc2a6573754f6726f54e86" kindref="member">XBEE_CMD_FLAG_QUEUE_CHANGE</ref>);</highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga4295dde3673b07f41e569e333abd9730" kindref="member">xbee_cmd_set_param</ref>(<sp/>request,<sp/>sas-&gt;channel_mask<sp/>&gt;&gt;<sp/>11);</highlight></codeline>
<codeline lineno="440"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/>#ifdef<sp/>XBEE_COMMISSIONING_VERBOSE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>printf(<sp/></highlight><highlight class="stringliteral">&quot;%s:<sp/>setting<sp/>SC=0x%04X\n&quot;</highlight><highlight class="normal">,<sp/>__FUNCTION__,</highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(<ref refid="group__hal__dos_1ga5a8b2dc9e45a9ee81a94ef304fb62505" kindref="member">uint16_t</ref>)<sp/>(sas-&gt;channel_mask<sp/>&gt;&gt;<sp/>11));</highlight></codeline>
<codeline lineno="443"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/>#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga2c58eedef60b41dd30ae1f6b475606a8" kindref="member">xbee_cmd_send</ref>(<sp/>request);</highlight></codeline>
<codeline lineno="445"><highlight class="normal"></highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>release<sp/>the<sp/>handle<sp/>so<sp/>it&apos;s<sp/>available<sp/>for<sp/>reuse</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga91641619ae34da34615193962ffd1525" kindref="member">xbee_cmd_release_handle</ref>(<sp/>request);</highlight></codeline>
<codeline lineno="448"><highlight class="normal"></highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="450"><highlight class="normal"></highlight></codeline>
<codeline lineno="451"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/>#undef<sp/>_set_param_bytes</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="452"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/>#undef<sp/>_hex_dump</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="453"><highlight class="normal">}</highlight></codeline>
<codeline lineno="454"><highlight class="normal"></highlight></codeline>
<codeline lineno="455"><highlight class="normal"></highlight><highlight class="comment">/***<sp/>BeginHeader<sp/>xbee_commissioning_tick<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="456"><highlight class="normal"></highlight><highlight class="comment">/***<sp/>EndHeader<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="457"><highlight class="normal"></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="458"><highlight class="comment"><sp/><sp/><sp/>Need<sp/>to<sp/>call<sp/>from<sp/>main()<sp/>to<sp/>update<sp/>attributes<sp/>with<sp/>current<sp/>values<sp/>from</highlight></codeline>
<codeline lineno="459"><highlight class="comment"><sp/><sp/><sp/>XBee.</highlight></codeline>
<codeline lineno="460"><highlight class="comment">*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="461"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>xbee_commissioning_tick(<sp/><ref refid="structxbee__dev__t" kindref="compound">xbee_dev_t</ref><sp/>*xbee,<sp/><ref refid="structzcl__comm__state__t" kindref="compound">zcl_comm_state_t</ref><sp/>*comm)</highlight></codeline>
<codeline lineno="462"><highlight class="normal">{</highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>err;</highlight></codeline>
<codeline lineno="464"><highlight class="normal"></highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>for<sp/>delayed<sp/>restart.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>((comm-&gt;flags<sp/>&amp;<sp/><ref refid="group__zcl__commissioning_1gaa56ed48c4587dd4c657a1e69f7e2fba7" kindref="member">ZCL_COMM_FLAG_DELAYED_RESTART</ref>)</highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&amp;&amp;<sp/>(<ref refid="group__hal__dos_1gafd12020da5a235dfcf0c3c748fb5baed" kindref="member">int32_t</ref>)(xbee_millisecond_timer()<sp/>-<sp/>comm-&gt;<ref refid="group__zcl__commissioning_1ga54811501883a7b2225b1a3111f86b760" kindref="member">restart_ms</ref>)<sp/>&gt;=<sp/>0)</highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(comm-&gt;flags<sp/>&amp;<sp/><ref refid="group__zcl__commissioning_1ga656e9fbebbb767dd47a59363944a0ee4" kindref="member">ZCL_COMM_FLAG_FACTORY_RESET</ref>)</highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="471"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#ifdef<sp/>XBEE_COMMISSIONING_VERBOSE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>printf(<sp/></highlight><highlight class="stringliteral">&quot;%s:<sp/>reset<sp/>attribute<sp/>set<sp/>to<sp/>factory<sp/>default\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>__FUNCTION__);</highlight></codeline>
<codeline lineno="474"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>comm-&gt;sas<sp/>=<sp/>zcl_comm_default_sas;</highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(comm-&gt;flags<sp/>&amp;<sp/><ref refid="group__zcl__commissioning_1gaf041a27755c9719134f8a2ad59f124e3" kindref="member">ZCL_COMM_FLAG_INSTALL</ref>)</highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="479"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#ifdef<sp/>XBEE_COMMISSIONING_VERBOSE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>printf(<sp/></highlight><highlight class="stringliteral">&quot;%s:<sp/>installing<sp/>attribute<sp/>set\n&quot;</highlight><highlight class="normal">,<sp/>__FUNCTION__);</highlight></codeline>
<codeline lineno="481"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/>xbee_commissioning_set(<sp/>xbee,<sp/>&amp;comm-&gt;sas);</highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(err<sp/>!=<sp/>0)</highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="485"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#ifdef<sp/>XBEE_COMMISSIONING_VERBOSE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>printf(<sp/></highlight><highlight class="stringliteral">&quot;%s:<sp/>aborting,<sp/>xbee_commissioning_set<sp/>returned<sp/>%d\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>__FUNCTION__,<sp/>err);</highlight></codeline>
<codeline lineno="488"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="491"><highlight class="normal"></highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Instead<sp/>of<sp/>doing<sp/>ATWR<sp/>here,<sp/>set<sp/>a<sp/>flag<sp/>and<sp/>wait<sp/>until<sp/>the<sp/>device</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>is<sp/>joined<sp/>to<sp/>the<sp/>network.<sp/><sp/>Then<sp/>send<sp/>ATWR<sp/>and<sp/>clear<sp/>the<sp/>flag.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>comm-&gt;flags<sp/>|=<sp/><ref refid="group__zcl__commissioning_1ga83365bb85e2b264c1741d75e8522a754" kindref="member">ZCL_COMM_FLAG_SAVE_ON_JOIN</ref>;</highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="496"><highlight class="normal"></highlight></codeline>
<codeline lineno="497"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/>#ifdef<sp/>XBEE_COMMISSIONING_VERBOSE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>printf(<sp/></highlight><highlight class="stringliteral">&quot;%s:<sp/>performing<sp/>network<sp/>reset\n&quot;</highlight><highlight class="normal">,<sp/>__FUNCTION__);</highlight></codeline>
<codeline lineno="499"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/>#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga6b157fe048c0082253056a7bda0ba9bb" kindref="member">xbee_cmd_simple</ref>(<sp/>xbee,<sp/></highlight><highlight class="stringliteral">&quot;NR&quot;</highlight><highlight class="normal">,<sp/>0);</highlight></codeline>
<codeline lineno="501"><highlight class="normal"></highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>**<sp/>workaround<sp/>**</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Coordinator<sp/>does<sp/>not<sp/>notify<sp/>us<sp/>when<sp/>it&apos;s<sp/>leaving<sp/>the<sp/>network,<sp/>so<sp/>we&apos;ll</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>jump<sp/>the<sp/>gun<sp/>and<sp/>assume<sp/>we&apos;ve<sp/>already<sp/>left<sp/>the<sp/>network<sp/>so<sp/>we&apos;ll<sp/>be</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>in<sp/>the<sp/>correct<sp/>state,<sp/>watching<sp/>for<sp/>the<sp/>COORD_START<sp/>modem<sp/>status.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>xbee-&gt;<ref refid="group__xbee__device_1ga8547395da056b57ba7c6b26c0c0f6ccf" kindref="member">wpan_dev</ref>.<ref refid="group__wpan__aps_1ga1e87af3c18a2fd36c61faf89949bdc3f" kindref="member">flags</ref><sp/>&amp;=<sp/>~(<ref refid="group__wpan__aps_1gaa06c0d38b4a130f9657abf26c73b49dd" kindref="member">WPAN_FLAG_JOINED</ref><sp/>|<sp/><ref refid="group__wpan__aps_1ga6508b417838fc0a043f5570b65e3f24b" kindref="member">WPAN_FLAG_AUTHENTICATED</ref>);</highlight></codeline>
<codeline lineno="507"><highlight class="normal"></highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>clear<sp/>delayed<sp/>restart<sp/>and<sp/>related<sp/>flags</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>comm-&gt;flags<sp/>&amp;=<sp/>~(<ref refid="group__zcl__commissioning_1gaa56ed48c4587dd4c657a1e69f7e2fba7" kindref="member">ZCL_COMM_FLAG_DELAYED_RESTART</ref></highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/><ref refid="group__zcl__commissioning_1ga656e9fbebbb767dd47a59363944a0ee4" kindref="member">ZCL_COMM_FLAG_FACTORY_RESET</ref><sp/>|<sp/><ref refid="group__zcl__commissioning_1gaf041a27755c9719134f8a2ad59f124e3" kindref="member">ZCL_COMM_FLAG_INSTALL</ref>);</highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="512"><highlight class="normal"></highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(comm-&gt;state)</highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="group__zcl__commissioning_1gabf17d49005afcefa60714a10c1c54c74" kindref="member">ZCL_COMM_STATE_INIT</ref>:</highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(xbee_commissioning_init(<sp/>comm,<sp/>xbee)<sp/>==<sp/>0)</highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="518"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#ifdef<sp/>XBEE_COMMISSIONING_VERBOSE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>printf(<sp/></highlight><highlight class="stringliteral">&quot;%s:<sp/>loading<sp/>SAS<sp/>from<sp/>XBee\n&quot;</highlight><highlight class="normal">,<sp/>__FUNCTION__);</highlight></codeline>
<codeline lineno="520"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>comm-&gt;state<sp/>=<sp/><ref refid="group__zcl__commissioning_1ga44abce1dcc61c33053dffe8641e4b167" kindref="member">ZCL_COMM_STATE_LOADING</ref>;</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="524"><highlight class="normal"></highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="group__zcl__commissioning_1ga44abce1dcc61c33053dffe8641e4b167" kindref="member">ZCL_COMM_STATE_LOADING</ref>:</highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>waiting<sp/>for<sp/>AT<sp/>command<sp/>layer<sp/>to<sp/>finish<sp/>loading</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="528"><highlight class="normal"></highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="group__zcl__commissioning_1ga03c5eb470ac12387be9e3e48953750f5" kindref="member">ZCL_COMM_STATE_STARTUP</ref>:</highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>depending<sp/>on<sp/>startup_control,<sp/>send<sp/>possible<sp/>NR<sp/>to<sp/>force<sp/>rejoin</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(comm-&gt;sas.startup_control<sp/>&gt;=<sp/>ZCL_COMM_STARTUP_REJOIN)</highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="533"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#ifdef<sp/>XBEE_COMMISSIONING_VERBOSE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>printf(<sp/></highlight><highlight class="stringliteral">&quot;%s:<sp/>network<sp/>reset<sp/>for<sp/>startup_control<sp/>%u\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>__FUNCTION__,<sp/>comm-&gt;sas.startup_control);</highlight></codeline>
<codeline lineno="536"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga19d16fbaf1da1cc581fbedcb36f7263f" kindref="member">xbee_cmd_execute</ref>(<sp/>xbee,<sp/></highlight><highlight class="stringliteral">&quot;NR&quot;</highlight><highlight class="normal">,<sp/>NULL,<sp/>0);</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>comm-&gt;state<sp/>=<sp/><ref refid="group__zcl__commissioning_1ga60e0581b929ae09262680136205a2516" kindref="member">ZCL_COMM_STATE_UNJOINED</ref>;</highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="541"><highlight class="normal"></highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="group__zcl__commissioning_1ga60e0581b929ae09262680136205a2516" kindref="member">ZCL_COMM_STATE_UNJOINED</ref>:</highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="group__wpan__aps_1gabe1e612e16ea40f970a7f160cae6de3a" kindref="member">WPAN_DEV_IS_JOINED</ref>(<sp/>&amp;xbee-&gt;<ref refid="group__xbee__device_1ga8547395da056b57ba7c6b26c0c0f6ccf" kindref="member">wpan_dev</ref>))</highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="545"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(comm-&gt;flags<sp/>&amp;<sp/><ref refid="group__zcl__commissioning_1ga83365bb85e2b264c1741d75e8522a754" kindref="member">ZCL_COMM_FLAG_SAVE_ON_JOIN</ref>)</highlight></codeline>
<codeline lineno="546"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>send<sp/>an<sp/>ATWR<sp/>to<sp/>commit<sp/>these<sp/>changes<sp/>to<sp/>the<sp/>XBee</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="548"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#ifdef<sp/>XBEE_COMMISSIONING_VERBOSE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>printf(<sp/></highlight><highlight class="stringliteral">&quot;%s:<sp/>joined<sp/>with<sp/>new<sp/>settings,<sp/>saving<sp/>changes\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>__FUNCTION__);</highlight></codeline>
<codeline lineno="551"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__xbee__atcmd_1ga19d16fbaf1da1cc581fbedcb36f7263f" kindref="member">xbee_cmd_execute</ref>(<sp/>xbee,<sp/></highlight><highlight class="stringliteral">&quot;WR&quot;</highlight><highlight class="normal">,<sp/>NULL,<sp/>0);</highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>comm-&gt;flags<sp/>&amp;=<sp/>~<ref refid="group__zcl__commissioning_1ga83365bb85e2b264c1741d75e8522a754" kindref="member">ZCL_COMM_FLAG_SAVE_ON_JOIN</ref>;</highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="555"><highlight class="normal"></highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>wait<sp/>for<sp/>the<sp/>stack<sp/>to<sp/>finish<sp/>loading<sp/>ATMY</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(xbee-&gt;<ref refid="group__xbee__device_1ga8547395da056b57ba7c6b26c0c0f6ccf" kindref="member">wpan_dev</ref>.<ref refid="group__wpan__aps_1ga66a58a737aee9733019399e2eceabf4a" kindref="member">address</ref>.network<sp/>!=<sp/><ref refid="group__wpan__types_1ga1674d7b825e528a482725d1c06b02c10" kindref="member">WPAN_NET_ADDR_UNDEFINED</ref>)</highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>comm-&gt;sas.short_address<sp/>=<sp/>xbee-&gt;<ref refid="group__xbee__device_1ga8547395da056b57ba7c6b26c0c0f6ccf" kindref="member">wpan_dev</ref>.<ref refid="group__wpan__aps_1ga66a58a737aee9733019399e2eceabf4a" kindref="member">address</ref>.network;</highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>refresh<sp/>the<sp/>settings<sp/>that<sp/>change<sp/>when<sp/>joined</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<sp/>xbee_commissioning_query(<sp/>comm,<sp/>xbee,<sp/></highlight><highlight class="stringliteral">&quot;OP&quot;</highlight><highlight class="normal">))</highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="563"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#ifdef<sp/>XBEE_COMMISSIONING_VERBOSE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>printf(<sp/></highlight><highlight class="stringliteral">&quot;%s:<sp/>refreshing<sp/>network<sp/>settings\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>__FUNCTION__);</highlight></codeline>
<codeline lineno="566"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>comm-&gt;state<sp/>=<sp/><ref refid="group__zcl__commissioning_1gae9523cf195068a92283ba0d44424e105" kindref="member">ZCL_COMM_STATE_REFRESH</ref>;</highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="571"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="572"><highlight class="normal"></highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="group__zcl__commissioning_1gae9523cf195068a92283ba0d44424e105" kindref="member">ZCL_COMM_STATE_REFRESH</ref>:</highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>waiting<sp/>for<sp/>AT<sp/>command<sp/>layer<sp/>to<sp/>finish<sp/>loading</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="576"><highlight class="normal"></highlight></codeline>
<codeline lineno="577"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="group__zcl__commissioning_1ga4d8a61e021ef1c4826b18d6eb356c96e" kindref="member">ZCL_COMM_STATE_JOINED</ref>:</highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<sp/><ref refid="group__wpan__aps_1gabe1e612e16ea40f970a7f160cae6de3a" kindref="member">WPAN_DEV_IS_JOINED</ref>(<sp/>&amp;xbee-&gt;<ref refid="group__xbee__device_1ga8547395da056b57ba7c6b26c0c0f6ccf" kindref="member">wpan_dev</ref>))</highlight></codeline>
<codeline lineno="579"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="580"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#ifdef<sp/>XBEE_COMMISSIONING_VERBOSE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="581"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>printf(<sp/></highlight><highlight class="stringliteral">&quot;%s:<sp/>switching<sp/>to<sp/>UNJOINED<sp/>state\n&quot;</highlight><highlight class="normal">,<sp/>__FUNCTION__);</highlight></codeline>
<codeline lineno="582"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="583"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>comm-&gt;sas.short_address<sp/>=<sp/><ref refid="group__wpan__types_1ga1674d7b825e528a482725d1c06b02c10" kindref="member">WPAN_NET_ADDR_UNDEFINED</ref>;</highlight></codeline>
<codeline lineno="584"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memset(<sp/>&amp;comm-&gt;sas.extended_panid,<sp/>0xFF,</highlight></codeline>
<codeline lineno="585"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(comm-&gt;sas.extended_panid));</highlight></codeline>
<codeline lineno="586"><highlight class="normal"></highlight></codeline>
<codeline lineno="587"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>comm-&gt;state<sp/>=<sp/><ref refid="group__zcl__commissioning_1ga60e0581b929ae09262680136205a2516" kindref="member">ZCL_COMM_STATE_UNJOINED</ref>;</highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="589"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="591"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="src/xbee/xbee_commissioning.c"/>
  </compounddef>
</doxygen>
