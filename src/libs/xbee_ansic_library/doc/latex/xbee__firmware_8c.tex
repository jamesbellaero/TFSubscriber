\hypertarget{xbee__firmware_8c}{}\section{src/xbee/xbee\+\_\+firmware.c File Reference}
\label{xbee__firmware_8c}\index{src/xbee/xbee\+\_\+firmware.\+c@{src/xbee/xbee\+\_\+firmware.\+c}}


A\+PI related to updating X\+Bee firmware on the local X\+Bee module.  


{\ttfamily \#include $<$errno.\+h$>$}\newline
{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include \char`\"{}xbee/platform.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}xbee/atmode.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}xbee/byteorder.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}xbee/firmware.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define {\bfseries \+\_\+xbee\+\_\+firmware\+\_\+debug}
\item 
\#define {\bfseries \+\_\+\+T\+I\+M\+E\+\_\+\+E\+L\+A\+P\+S\+ED}(x)~(\hyperlink{group__hal_ga22b4e3df788254ca5f8530e9aee58515}{xbee\+\_\+millisecond\+\_\+timer}() -\/ source-\/$>$timer $>$ (x))
\item 
\#define {\bfseries X\+B\+E\+E\+\_\+\+O\+E\+M\+\_\+\+M\+A\+G\+I\+C\+\_\+\+N\+U\+M\+B\+ER}~0x93\+FD
\item 
\#define {\bfseries X\+B\+E\+E\+\_\+\+O\+E\+M\+\_\+\+O\+F\+S\+\_\+\+M\+A\+G\+I\+C\+\_\+\+N\+U\+M\+B\+ER}~0
\item 
\#define {\bfseries X\+B\+E\+E\+\_\+\+O\+E\+M\+\_\+\+O\+F\+S\+\_\+\+C\+H\+E\+C\+K\+S\+UM}~2
\item 
\#define {\bfseries X\+B\+E\+E\+\_\+\+O\+E\+M\+\_\+\+O\+F\+S\+\_\+\+I\+M\+A\+G\+E\+\_\+\+L\+EN}~4
\item 
\#define {\bfseries X\+B\+E\+E\+\_\+\+O\+E\+M\+\_\+\+O\+F\+S\+\_\+\+H\+E\+A\+D\+E\+R\+\_\+\+L\+EN}~8
\item 
\#define {\bfseries X\+B\+E\+E\+\_\+\+O\+E\+M\+\_\+\+O\+F\+S\+\_\+\+M\+O\+D\+U\+L\+E\+\_\+\+ID}~10
\item 
\#define {\bfseries X\+B\+E\+E\+\_\+\+O\+E\+M\+\_\+\+O\+F\+S\+\_\+\+S\+W\+\_\+\+C\+O\+M\+P\+A\+T\+\_\+\+L\+E\+V\+EL}~11
\item 
\#define {\bfseries X\+B\+E\+E\+\_\+\+O\+E\+M\+\_\+\+O\+F\+S\+\_\+\+F\+W\+\_\+\+V\+E\+R\+S\+I\+ON}~12
\item 
\#define {\bfseries X\+B\+E\+E\+\_\+\+B\+O\+O\+T\+L\+O\+A\+D\+E\+R\+\_\+\+A\+CK}~\textquotesingle{}U\textquotesingle{}
\item 
\#define {\bfseries X\+B\+E\+E\+\_\+\+B\+O\+O\+T\+L\+O\+A\+D\+E\+R\+\_\+\+N\+AK}~0x11
\item 
\#define {\bfseries X\+B\+E\+E\+\_\+\+O\+E\+M\+\_\+\+F\+L\+A\+G\+\_\+\+N\+O\+NE}~0x0000
\item 
\#define {\bfseries X\+B\+E\+E\+\_\+\+O\+E\+M\+\_\+\+F\+L\+A\+G\+\_\+\+F\+O\+R\+C\+E\+U\+P\+D\+A\+TE}~0x0001
\item 
\#define {\bfseries \+\_\+\+T\+I\+M\+E\+\_\+\+E\+L\+A\+P\+S\+ED}(x)~(\hyperlink{group__hal_ga22b4e3df788254ca5f8530e9aee58515}{xbee\+\_\+millisecond\+\_\+timer}() -\/ source-\/$>$timer $>$ (x))
\end{DoxyCompactItemize}
\subsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef \hyperlink{group___s_x_a_ga4233297bd31be5c273d4fb0758cc54d7}{P\+A\+C\+K\+E\+D\+\_\+\+S\+T\+R\+U\+CT} {\bfseries \+\_\+xbee\+\_\+oem\+\_\+header}
\end{DoxyCompactItemize}
\subsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{group__xbee__firmware_ga99fb83031ce9923c84392b4e92f956b5}\label{group__xbee__firmware_ga99fb83031ce9923c84392b4e92f956b5}} 
enum \{ \newline
{\bfseries X\+B\+E\+E\+\_\+\+F\+W\+\_\+\+S\+T\+A\+T\+E\+\_\+\+I\+N\+IT}, 
{\bfseries X\+B\+E\+E\+\_\+\+F\+W\+\_\+\+S\+T\+A\+T\+E\+\_\+\+R\+E\+S\+ET}, 
{\bfseries X\+B\+E\+E\+\_\+\+F\+W\+\_\+\+S\+T\+A\+T\+E\+\_\+\+T\+O\+G\+G\+LE}, 
{\bfseries X\+B\+E\+E\+\_\+\+F\+W\+\_\+\+S\+T\+A\+T\+E\+\_\+\+B\+R\+E\+AK}, 
\newline
{\bfseries X\+B\+E\+E\+\_\+\+F\+W\+\_\+\+S\+T\+A\+T\+E\+\_\+\+P\+R\+O\+M\+PT}, 
{\bfseries X\+B\+E\+E\+\_\+\+F\+W\+\_\+\+S\+T\+A\+T\+E\+\_\+\+X\+M\+O\+D\+E\+M\+\_\+\+W\+A\+IT}, 
{\bfseries X\+B\+E\+E\+\_\+\+F\+W\+\_\+\+S\+T\+A\+T\+E\+\_\+\+X\+M\+O\+D\+E\+M\+\_\+\+S\+E\+ND}, 
{\bfseries X\+B\+E\+E\+\_\+\+F\+W\+\_\+\+S\+T\+A\+T\+E\+\_\+\+X\+M\+O\+D\+E\+M\+\_\+\+D\+O\+NE}, 
\newline
{\bfseries X\+B\+E\+E\+\_\+\+F\+W\+\_\+\+S\+T\+A\+T\+E\+\_\+\+F\+I\+N\+A\+L\+\_\+\+P\+R\+O\+M\+PT}, 
{\bfseries X\+B\+E\+E\+\_\+\+F\+W\+\_\+\+S\+T\+A\+T\+E\+\_\+\+C\+M\+D\+\_\+\+P\+E\+N\+D\+I\+NG}, 
{\bfseries X\+B\+E\+E\+\_\+\+F\+W\+\_\+\+S\+T\+A\+T\+E\+\_\+\+C\+MD}, 
{\bfseries X\+B\+E\+E\+\_\+\+F\+W\+\_\+\+S\+T\+A\+T\+E\+\_\+\+P\+A\+R\+S\+E\+\_\+\+R\+E\+S\+P\+O\+N\+SE}, 
\newline
{\bfseries X\+B\+E\+E\+\_\+\+F\+W\+\_\+\+S\+T\+A\+T\+E\+\_\+\+C\+M\+D\+\_\+\+HV}, 
{\bfseries X\+B\+E\+E\+\_\+\+F\+W\+\_\+\+S\+T\+A\+T\+E\+\_\+\+C\+M\+D\+\_\+\+C\+O\+M\+P\+AT}, 
{\bfseries X\+B\+E\+E\+\_\+\+F\+W\+\_\+\+S\+T\+A\+T\+E\+\_\+\+C\+M\+D\+\_\+\+VR}, 
{\bfseries X\+B\+E\+E\+\_\+\+F\+W\+\_\+\+S\+T\+A\+T\+E\+\_\+\+C\+M\+D\+\_\+\+C\+F1}, 
\newline
{\bfseries X\+B\+E\+E\+\_\+\+F\+W\+\_\+\+S\+T\+A\+T\+E\+\_\+\+C\+M\+D\+\_\+\+SL}, 
{\bfseries X\+B\+E\+E\+\_\+\+F\+W\+\_\+\+S\+T\+A\+T\+E\+\_\+\+C\+M\+D\+\_\+\+P\+R\+OG}, 
{\bfseries X\+B\+E\+E\+\_\+\+F\+W\+\_\+\+S\+T\+A\+T\+E\+\_\+\+C\+M\+D\+\_\+\+FR}, 
{\bfseries X\+B\+E\+E\+\_\+\+F\+W\+\_\+\+S\+T\+A\+T\+E\+\_\+\+B\+O\+O\+T\+L\+O\+A\+D\+ER}, 
\newline
{\bfseries X\+B\+E\+E\+\_\+\+F\+W\+\_\+\+S\+T\+A\+T\+E\+\_\+\+T\+X\+\_\+\+S\+T\+A\+RT}, 
{\bfseries X\+B\+E\+E\+\_\+\+F\+W\+\_\+\+S\+T\+A\+T\+E\+\_\+\+T\+X\+\_\+\+B\+L\+O\+CK}, 
{\bfseries X\+B\+E\+E\+\_\+\+F\+W\+\_\+\+S\+T\+A\+T\+E\+\_\+\+S\+E\+N\+D\+I\+NG}, 
{\bfseries X\+B\+E\+E\+\_\+\+F\+W\+\_\+\+S\+T\+A\+T\+E\+\_\+\+R\+X\+\_\+\+B\+L\+O\+CK}, 
\newline
{\bfseries X\+B\+E\+E\+\_\+\+F\+W\+\_\+\+S\+T\+A\+T\+E\+\_\+\+R\+X\+\_\+\+F\+A\+IL}, 
{\bfseries X\+B\+E\+E\+\_\+\+F\+W\+\_\+\+S\+T\+A\+T\+E\+\_\+\+D\+O\+NE}, 
{\bfseries X\+B\+E\+E\+\_\+\+F\+W\+\_\+\+S\+T\+A\+T\+E\+\_\+\+F\+A\+I\+L\+U\+RE}, 
{\bfseries X\+B\+E\+E\+\_\+\+F\+W\+\_\+\+S\+T\+A\+T\+E\+\_\+\+S\+U\+C\+C\+E\+SS}
 \}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\+\_\+xbee\+\_\+firmware\+\_\+debug int \hyperlink{group__xbee__firmware_ga3ea95570f7d7366e42b0ee6ba21a1c41}{xbee\+\_\+fw\+\_\+install\+\_\+init} (\hyperlink{structxbee__dev__t}{xbee\+\_\+dev\+\_\+t} $\ast$xbee, const \hyperlink{structwpan__address__t}{wpan\+\_\+address\+\_\+t} \hyperlink{group__hal_gaef060b3456fdcc093a7210a762d5f2ed}{F\+AR} $\ast$target, \hyperlink{structxbee__fw__source__t}{xbee\+\_\+fw\+\_\+source\+\_\+t} $\ast$source)
\begin{DoxyCompactList}\small\item\em \begin{DoxyVerb}        Prepare to install new firmware on an attached XBee module.\end{DoxyVerb}
 \end{DoxyCompactList}\item 
\+\_\+xbee\+\_\+firmware\+\_\+debug unsigned int \hyperlink{group__xbee__firmware_ga8590708a38ac57ace8c816cc7cfd0859}{xbee\+\_\+fw\+\_\+install\+\_\+ebl\+\_\+state} (\hyperlink{structxbee__fw__source__t}{xbee\+\_\+fw\+\_\+source\+\_\+t} $\ast$source)
\begin{DoxyCompactList}\small\item\em Returns a unique value indicating the state of the .E\+BL install process. \end{DoxyCompactList}\item 
\+\_\+xbee\+\_\+firmware\+\_\+debug int \hyperlink{group__xbee__firmware_ga00113850eb74d0cb2928c9530d253381}{xbee\+\_\+fw\+\_\+install\+\_\+hcs08\+\_\+tick} (\hyperlink{structxbee__fw__source__t}{xbee\+\_\+fw\+\_\+source\+\_\+t} $\ast$source)
\begin{DoxyCompactList}\small\item\em Drive the firmware update process for the H\+C\+S08 application on Programmable X\+Bee modules. \end{DoxyCompactList}\item 
\+\_\+xbee\+\_\+firmware\+\_\+debug int \hyperlink{group__xbee__firmware_gaae62252a2e1331127c9df86b6ebfc4e8}{xbee\+\_\+fw\+\_\+install\+\_\+ebl\+\_\+tick} (\hyperlink{structxbee__fw__source__t}{xbee\+\_\+fw\+\_\+source\+\_\+t} $\ast$source)
\begin{DoxyCompactList}\small\item\em Drive the firmware update process for boards that use .E\+BL files to store their firmware. \end{DoxyCompactList}\item 
\+\_\+xbee\+\_\+firmware\+\_\+debug char \hyperlink{group__hal_gaef060b3456fdcc093a7210a762d5f2ed}{F\+AR} $\ast$ \hyperlink{group__xbee__firmware_ga8bee6e4bb7564c51bb38129e97a12e99}{xbee\+\_\+fw\+\_\+status\+\_\+ebl} (\hyperlink{structxbee__fw__source__t}{xbee\+\_\+fw\+\_\+source\+\_\+t} $\ast$source, char \hyperlink{group__hal_gaef060b3456fdcc093a7210a762d5f2ed}{F\+AR} $\ast$buffer)
\begin{DoxyCompactList}\small\item\em \begin{DoxyVerb}  Update \a buffer with the current install status of \a source.\end{DoxyVerb}
 \end{DoxyCompactList}\item 
\+\_\+xbee\+\_\+firmware\+\_\+debug int \hyperlink{group__xbee__firmware_ga279def556401f533d798bb3896302ced}{xbee\+\_\+fw\+\_\+read\+\_\+byte} (\hyperlink{structxbee__fw__source__t}{xbee\+\_\+fw\+\_\+source\+\_\+t} $\ast$source)
\item 
\+\_\+xbee\+\_\+firmware\+\_\+debug \hyperlink{group__hal__dos_ga5a8b2dc9e45a9ee81a94ef304fb62505}{uint16\+\_\+t} {\bfseries xbee\+\_\+fw\+\_\+read\+\_\+uint16} (\hyperlink{structxbee__fw__source__t}{xbee\+\_\+fw\+\_\+source\+\_\+t} $\ast$source)
\item 
\+\_\+xbee\+\_\+firmware\+\_\+debug \hyperlink{group__hal__dos_ga09a1e304d66d35dd47daffee9731edaa}{uint32\+\_\+t} {\bfseries xbee\+\_\+fw\+\_\+read\+\_\+uint32} (\hyperlink{structxbee__fw__source__t}{xbee\+\_\+fw\+\_\+source\+\_\+t} $\ast$source)
\item 
\+\_\+xbee\+\_\+firmware\+\_\+debug \hyperlink{group__hal__dos_ga5a8b2dc9e45a9ee81a94ef304fb62505}{uint16\+\_\+t} {\bfseries xbee\+\_\+fw\+\_\+hex2word} (const char $\ast$p\+String)
\item 
\+\_\+xbee\+\_\+firmware\+\_\+debug int \hyperlink{group__xbee__firmware_ga06368ad0d6cc0d4e92dbf36f8b233f90}{\+\_\+xbee\+\_\+oem\+\_\+verify} (\hyperlink{structxbee__fw__source__t}{xbee\+\_\+fw\+\_\+source\+\_\+t} $\ast$source)
\item 
\+\_\+xbee\+\_\+firmware\+\_\+debug int {\bfseries \+\_\+xbee\+\_\+fw\+\_\+send\+\_\+request} (\hyperlink{structxbee__fw__source__t}{xbee\+\_\+fw\+\_\+source\+\_\+t} $\ast$source, const \hyperlink{group__hal_gaef060b3456fdcc093a7210a762d5f2ed}{F\+AR} char $\ast$request, int next\+\_\+state)
\item 
\+\_\+xbee\+\_\+firmware\+\_\+debug int \hyperlink{group__xbee__firmware_gaea52642560ef68878fbca44e81df2be8}{xbee\+\_\+fw\+\_\+install\+\_\+oem\+\_\+tick} (\hyperlink{structxbee__fw__source__t}{xbee\+\_\+fw\+\_\+source\+\_\+t} $\ast$source)
\begin{DoxyCompactList}\small\item\em Install the firmware image stored in {\itshape source}. \end{DoxyCompactList}\item 
\+\_\+xbee\+\_\+firmware\+\_\+debug char \hyperlink{group__hal_gaef060b3456fdcc093a7210a762d5f2ed}{F\+AR} $\ast$ \hyperlink{group__xbee__firmware_ga0198db687345929eece03335ea1c7701}{xbee\+\_\+fw\+\_\+status\+\_\+oem} (\hyperlink{structxbee__fw__source__t}{xbee\+\_\+fw\+\_\+source\+\_\+t} $\ast$source, char \hyperlink{group__hal_gaef060b3456fdcc093a7210a762d5f2ed}{F\+AR} $\ast$buffer)
\begin{DoxyCompactList}\small\item\em Update {\itshape buffer} with the current install status of {\itshape source}. \end{DoxyCompactList}\item 
\+\_\+xbee\+\_\+firmware\+\_\+debug int \hyperlink{group__xbee__firmware_ga86a474f683ca3239ddea7b6414a6c555}{\+\_\+xbee\+\_\+fw\+\_\+buffer\+\_\+seek} (void \hyperlink{group__hal_gaef060b3456fdcc093a7210a762d5f2ed}{F\+AR} $\ast$context, \hyperlink{group__hal__dos_ga09a1e304d66d35dd47daffee9731edaa}{uint32\+\_\+t} offset)
\begin{DoxyCompactList}\small\item\em Helper function used when the source firmware image is entirely held in a buffer. \end{DoxyCompactList}\item 
\+\_\+xbee\+\_\+firmware\+\_\+debug int \hyperlink{group__xbee__firmware_ga3e528e574ae73a5f8bbc8b2783f04c4f}{\+\_\+xbee\+\_\+fw\+\_\+buffer\+\_\+read} (void \hyperlink{group__hal_gaef060b3456fdcc093a7210a762d5f2ed}{F\+AR} $\ast$context, void \hyperlink{group__hal_gaef060b3456fdcc093a7210a762d5f2ed}{F\+AR} $\ast$buffer, \hyperlink{group__hal__dos_ga2140805d08462d474b82ddc8d1c2f3e6}{int16\+\_\+t} bytes)
\begin{DoxyCompactList}\small\item\em Helper function used when the source firmware image is entirely held in a buffer. \end{DoxyCompactList}\item 
\+\_\+xbee\+\_\+firmware\+\_\+debug int \hyperlink{group__xbee__firmware_ga8ac2a394778a985657db3c7f08b12692}{xbee\+\_\+fw\+\_\+buffer\+\_\+init} (\hyperlink{structxbee__fw__buffer__t}{xbee\+\_\+fw\+\_\+buffer\+\_\+t} $\ast$fw, \hyperlink{group__hal__dos_ga09a1e304d66d35dd47daffee9731edaa}{uint32\+\_\+t} \hyperlink{group__zdo_gab2b3adeb2a67e656ff030b56727fd0ac}{length}, const char \hyperlink{group__hal_gaef060b3456fdcc093a7210a762d5f2ed}{F\+AR} $\ast$address)
\begin{DoxyCompactList}\small\item\em Helper function for setting up an \hyperlink{structxbee__fw__buffer__t}{xbee\+\_\+fw\+\_\+buffer\+\_\+t} for use with a source firmware image held entirely in a buffer. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hyperlink{group__hal__dos_ga5a8b2dc9e45a9ee81a94ef304fb62505}{uint16\+\_\+t} {\bfseries checksum}
\item 
\hyperlink{group__hal__dos_ga09a1e304d66d35dd47daffee9731edaa}{uint32\+\_\+t} {\bfseries image\+\_\+len}
\item 
\hyperlink{group__hal__dos_ga5a8b2dc9e45a9ee81a94ef304fb62505}{uint16\+\_\+t} {\bfseries header\+\_\+len}
\item 
\hyperlink{group__hal__dos_gae1affc9ca37cfb624959c866a73f83c2}{uint8\+\_\+t} {\bfseries module\+\_\+id}
\item 
\hyperlink{group__hal__dos_gae1affc9ca37cfb624959c866a73f83c2}{uint8\+\_\+t} {\bfseries software\+\_\+id}
\item 
{\bfseries xbee\+\_\+oem\+\_\+header\+\_\+t}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
A\+PI related to updating X\+Bee firmware on the local X\+Bee module. 

This could grow to support O\+TA (Over The Air) updates, via an expanded A\+PI.

Include helper A\+PI for initiating an update via firmware loaded to a far char buffer. An additional xbee\+\_\+firmware\+\_\+fat.\+lib could include helper functions for installing firmware from a file on the F\+AT filesystem.

Define X\+B\+E\+E\+\_\+\+F\+I\+R\+M\+W\+A\+R\+E\+\_\+\+V\+E\+R\+B\+O\+SE for debugging messages.

Define X\+B\+E\+E\+\_\+\+F\+I\+R\+M\+W\+A\+R\+E\+\_\+\+D\+E\+B\+UG to make the functions in this file debuggable. 